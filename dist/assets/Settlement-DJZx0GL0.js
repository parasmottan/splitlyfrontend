import{c as A,d as h,b as B,u as E,r as d,j as e}from"./index-DNKDXbwY.js";import{a as b,k as I,l as T}from"./index-BGOQgUEA.js";import{u as F}from"./groupStore-8BaMa8wT.js";import{A as N}from"./Avatar-DETDR1ce.js";import{M}from"./Modal-B2siUb_I.js";import{S as o}from"./Skeleton-Des0Eng2.js";const $=A(s=>({settlementData:null,loading:!1,error:null,fetchSettlements:async n=>{var r,i;try{s({loading:!0,error:null});const{data:l}=await h.get(`/settlements/${n}`);return s({settlementData:l,loading:!1}),l}catch(l){s({error:((i=(r=l.response)==null?void 0:r.data)==null?void 0:i.message)||"Failed to fetch settlements",loading:!1})}},settleAll:async n=>{var r,i;try{s({loading:!0,error:null});const{data:l}=await h.post(`/settlements/${n}/settle-all`);return s({loading:!1}),l}catch(l){const c=((i=(r=l.response)==null?void 0:r.data)==null?void 0:i.message)||"Failed to settle";throw s({error:c,loading:!1}),new Error(c)}},settleSingle:async(n,r)=>{var i,l;try{const{data:c}=await h.post(`/settlements/${n}/settle-single`,r);return c}catch(c){throw new Error(((l=(i=c.response)==null?void 0:i.data)==null?void 0:l.message)||"Failed to settle")}},clearSettlements:()=>s({settlementData:null,error:null})}));function O(){var j,f;const{id:s}=B(),n=E(),{settlementData:r,loading:i,fetchSettlements:l,settleAll:c,settleSingle:g}=$(),{fetchGroup:x}=F(),[k,p]=d.useState(!1),[u,y]=d.useState(!1);d.useEffect(()=>{l(s)},[s]);const C=d.useCallback(async()=>{y(!0);try{await c(s),await x(s),n(`/groups/${s}/settled`,{replace:!0})}catch{}y(!1)},[s,c,x,n]),z=d.useCallback(async a=>{try{await g(s,{fromUser:a.from._id,toUser:a.to._id,amount:a.amount}),l(s),x(s)}catch{}},[s,g,l,x]);if(i&&!r)return e.jsxs("div",{className:"page page-white",style:{padding:"0 20px"},children:[e.jsxs("div",{className:"header",children:[e.jsxs("button",{className:"header-back",onClick:()=>n(-1),children:[e.jsx(b,{style:{fontSize:"20px"}})," Back"]}),e.jsx("span",{className:"header-title",children:"Settle Up"}),e.jsx("div",{style:{width:"60px"}})]}),e.jsxs("div",{style:{textAlign:"center",padding:"24px 0"},children:[e.jsx(o,{width:"100px",height:"13px",style:{margin:"0 auto 8px"}}),e.jsx(o,{width:"160px",height:"36px",style:{margin:"0 auto 8px"}}),e.jsx(o,{width:"120px",height:"13px",style:{margin:"0 auto"}})]}),e.jsx(o,{width:"140px",height:"14px",style:{marginBottom:"16px"}}),[1,2].map(a=>e.jsx("div",{className:"card",style:{marginBottom:"10px",padding:"16px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx(o,{width:"32px",height:"32px",borderRadius:"50%"}),e.jsx(o,{width:"20px",height:"20px"}),e.jsx(o,{width:"32px",height:"32px",borderRadius:"50%"}),e.jsxs("div",{style:{flex:1},children:[e.jsx(o,{width:"60px",height:"16px",style:{marginBottom:"6px"}}),e.jsx(o,{width:"80px",height:"12px"})]}),e.jsx(o,{width:"70px",height:"32px",borderRadius:"9999px"})]})},a))]});const t=r,m=(t==null?void 0:t.currencySymbol)||"â‚¹";return e.jsxs("div",{className:"page page-white",style:{padding:"0 20px"},children:[e.jsxs("div",{className:"header",children:[e.jsxs("button",{className:"header-back",onClick:()=>n(-1),children:[e.jsx(b,{style:{fontSize:"20px"}})," Back"]}),e.jsx("span",{className:"header-title",children:"Settle Up"}),e.jsx("div",{style:{width:"60px"}})]}),e.jsxs("div",{style:{textAlign:"center",padding:"24px 0"},children:[e.jsx("p",{style:{fontSize:"13px",color:"var(--text-secondary)",fontWeight:"500",marginBottom:"4px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Total to settle"}),e.jsxs("p",{style:{fontSize:"36px",fontWeight:"700",letterSpacing:"-0.5px"},children:[m,((t==null?void 0:t.totalToSettle)||0).toFixed(2)]}),e.jsxs("p",{style:{fontSize:"15px",color:"var(--text-secondary)",marginTop:"4px"},children:[(t==null?void 0:t.pendingCount)||0," payment",(t==null?void 0:t.pendingCount)!==1?"s":""," pending"]})]}),((j=t==null?void 0:t.transfers)==null?void 0:j.length)>0?e.jsxs("div",{children:[e.jsx("h3",{className:"caption",style:{marginBottom:"12px"},children:"OPTIMIZED PAYMENTS"}),t.transfers.map((a,S)=>{var v,w;return e.jsx("div",{className:"card animate-fade-in",style:{marginBottom:"10px",padding:"16px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(N,{name:a.from.name,size:"sm"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",flex:"0 0 auto"},children:[e.jsx("span",{style:{fontSize:"11px",color:"var(--text-secondary)"},children:"pays"}),e.jsx(I,{style:{color:"var(--blue)",fontSize:"16px"}})]}),e.jsx(N,{name:a.to.name,size:"sm"}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("p",{style:{fontWeight:"600",fontSize:"17px"},children:[m,a.amount.toFixed(2)]}),e.jsxs("p",{style:{fontSize:"13px",color:"var(--text-secondary)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[(v=a.from.name)==null?void 0:v.split(" ")[0]," to ",(w=a.to.name)==null?void 0:w.split(" ")[0]]})]}),e.jsx("button",{onClick:()=>z(a),style:{padding:"8px 16px",background:"var(--blue-light)",color:"var(--blue)",borderRadius:"9999px",fontWeight:"600",fontSize:"14px",border:"none",cursor:"pointer",transition:"transform 120ms ease-out"},children:"Settle"})]})},S)})]}):e.jsxs("div",{className:"empty-state",style:{padding:"40px 20px"},children:[e.jsx("div",{className:"empty-state-icon",children:e.jsx(T,{style:{fontSize:"32px",color:"var(--green)"}})}),e.jsx("h3",{className:"empty-state-title",children:"All settled!"}),e.jsx("p",{className:"empty-state-text",children:"Everyone's even. Great teamwork!"})]}),((f=t==null?void 0:t.transfers)==null?void 0:f.length)>0&&e.jsx("button",{className:"btn-primary",onClick:()=>p(!0),style:{marginTop:"24px",marginBottom:"32px"},children:"Settle All Balances"}),e.jsxs(M,{show:k,title:"Settle All?",message:`Mark all ${(t==null?void 0:t.pendingCount)||0} payment(s) totalling ${m}${((t==null?void 0:t.totalToSettle)||0).toFixed(2)} as settled?`,onClose:()=>p(!1),variant:"alert",children:[e.jsx("div",{className:"modal-divider"}),e.jsxs("div",{className:"modal-actions-row",children:[e.jsx("button",{onClick:()=>p(!1),children:"Cancel"}),e.jsx("button",{className:"modal-btn-primary",onClick:C,disabled:u,children:u?"Settling...":"Confirm"})]})]})]})}export{O as default};
