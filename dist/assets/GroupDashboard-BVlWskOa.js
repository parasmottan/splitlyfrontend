import{c as O,b as R,d as B,u as T,a as _,r as k,j as t}from"./index-B3lqKPvk.js";import{a as Y,c as N}from"./index-BJ7B7Yjc.js";import{u as G}from"./groupStore-BYNz21HU.js";import{A as H}from"./Avatar-yNoXF_l8.js";import{M as P}from"./Modal-W7hMZg0T.js";import{S as w}from"./Skeleton-D7zNthvj.js";const X=O((i,o)=>({notifications:[],unreadCount:0,loading:!1,fetchNotifications:async()=>{i({loading:!0});try{const{data:n}=await R.get("/notifications");i({notifications:n,unreadCount:n.filter(s=>!s.isRead).length,loading:!1})}catch{i({loading:!1})}},markAsRead:async n=>{try{await R.patch(`/notifications/${n}/read`);const s=o().notifications.map(a=>a._id===n?{...a,isRead:!0}:a);i({notifications:s,unreadCount:s.filter(a=>!a.isRead).length})}catch{}},markAllRead:async()=>{try{await R.post("/notifications/read-all");const n=o().notifications.map(s=>({...s,isRead:!0}));i({notifications:n,unreadCount:0})}catch{}},sendReminder:async(n,s,a,h)=>{try{return await R.post("/notifications/remind",{debtorId:n,groupId:s,amount:a,message:h}),!0}catch(l){throw l}}})),D={food:{emoji:"ğŸ•",color:"#FF9500",bg:"rgba(255,149,0,0.15)"},drinks:{emoji:"ğŸº",color:"#5AC8FA",bg:"rgba(90,200,250,0.15)"},transport:{emoji:"â›½",color:"#FFCC00",bg:"rgba(255,204,0,0.15)"},rent:{emoji:"ğŸ ",color:"#FF3B30",bg:"rgba(255,59,48,0.15)"},entertainment:{emoji:"ğŸ¬",color:"#AF52DE",bg:"rgba(175,82,222,0.15)"},groceries:{emoji:"ğŸ›’",color:"#34C759",bg:"rgba(52,199,89,0.15)"},travel:{emoji:"âœˆï¸",color:"#007AFF",bg:"rgba(0,122,255,0.15)"},other:{emoji:"ğŸ’¸",color:"#8E8E93",bg:"rgba(142,142,147,0.15)"}};function q(i){const o=Date.now()-new Date(i),n=Math.floor(o/6e4);if(n<60)return`${n||1}m ago`;const s=Math.floor(n/60);if(s<24)return`${s}h ago`;const a=Math.floor(s/24);return a<7?`${a}d ago`:new Date(i).toLocaleDateString("en-IN",{month:"short",day:"numeric"})}const z=["#6347F5","#FFD60A","#30D158","#FF6B6B","#5AC8FA","#FF9F0A"];function V({memberBalances:i,members:o,totalSpend:n,currSymbol:s,user:a}){const d=2*Math.PI*88,C=o.map(e=>{var r;return{id:e.user._id,name:e.user.name,amount:((r=i==null?void 0:i[e.user._id])==null?void 0:r.paid)||0}}),y=C.reduce((e,r)=>e+r.amount,0)||1;let m=0;const S=C.map((e,r)=>{const x=e.amount/y,c=x*d,u=d-c,b={...e,fraction:x,dash:c,gap:u,offset:m,color:z[r%z.length]};return m+=c,b});return t.jsxs("div",{style:{position:"relative",width:"256px",height:"256px",margin:"0 auto"},children:[t.jsxs("svg",{width:"256",height:"256",style:{transform:"rotate(-90deg)"},children:[t.jsx("circle",{cx:128,cy:128,r:88,fill:"none",stroke:"#F0F0F5",strokeWidth:18}),S.map((e,r)=>t.jsx("circle",{cx:128,cy:128,r:88,fill:"none",stroke:e.color,strokeWidth:18,strokeDasharray:`${e.dash-4} ${d-e.dash+4}`,strokeDashoffset:-e.offset,strokeLinecap:"round",style:{transition:"stroke-dasharray 600ms ease"}},e.id))]}),t.jsxs("div",{style:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[t.jsx("p",{style:{fontSize:"12px",fontWeight:"700",color:"#8E8E93",letterSpacing:"1px",textTransform:"uppercase",marginBottom:"4px"},children:"TOTAL POOL"}),t.jsxs("p",{style:{fontSize:"28px",fontWeight:"800",color:"#1C1C1E",letterSpacing:"-1px",lineHeight:"1"},children:[s,n.toLocaleString()]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",marginTop:"6px"},children:[t.jsx("svg",{width:"14",height:"14",viewBox:"0 0 14 14",children:t.jsx("path",{d:"M7 11.5V2.5M7 2.5L3 6M7 2.5L11 6",stroke:"#34C759",strokeWidth:"1.5",strokeLinecap:"round"})}),t.jsx("span",{style:{fontSize:"13px",fontWeight:"700",color:"#34C759"},children:"Active"})]})]}),o.slice(0,Math.min(o.length,4)).map((e,r)=>{const x=r/Math.min(o.length,4)*2*Math.PI-Math.PI/2,c=88+18/2+24,u=128+c*Math.cos(x),b=128+c*Math.sin(x),F=i==null?void 0:i[e.user._id],j=(F==null?void 0:F.net)||0;e.user._id,a==null||a._id;const v=z[r%z.length];return t.jsxs("div",{style:{position:"absolute",left:`${u-22}px`,top:`${b-22}px`,display:"flex",flexDirection:"column",alignItems:"center",gap:"2px"},children:[t.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",overflow:"hidden",border:`3px solid ${v}`,boxShadow:"0 2px 8px rgba(0,0,0,0.12)"},children:t.jsx(H,{name:e.user.name,style:{width:"40px",height:"40px",fontSize:"15px"}})}),Math.abs(j)>.5&&t.jsxs("div",{style:{background:j>0?"#34C759":"#FF3B30",borderRadius:"8px",padding:"1px 5px",fontSize:"9px",fontWeight:"700",color:"#fff",whiteSpace:"nowrap"},children:[j>0?"+":"",s,Math.abs(j).toFixed(0)]})]},e.user._id)})]})}const J=k.memo(function({expense:o,userId:n,currSymbol:s,isLast:a}){var m,S,e,r,x,c;const h=D[o.category]||D.other,l=(m=o.splits)==null?void 0:m.find(u=>{var b;return((b=u.user)==null?void 0:b.toString())===n||u.user===n}),p=((S=o.paidBy)==null?void 0:S._id)===n;let f="#8E8E93",d="";if(p&&!l)o.amount,f="#34C759",d=`+${s}${o.amount.toFixed(2)} Paid by you`;else if(p&&l){const u=o.amount-(l.amount||0);f="#34C759",d=`+${s}${u.toFixed(2)} Owed to you`}else l&&(l.amount,f="#FF3B30",d=`-${s}${l.amount.toFixed(2)} Your share`);const C=((e=o.splits)==null?void 0:e.length)||0,y=o.splitType==="equal"?`Split equally among ${C}`:o.splitType==="custom"?"Split by amount":"Split by percentage";return t.jsxs("div",{style:{background:"#fff",borderRadius:"20px",padding:"16px",marginBottom:a?0:"12px",boxShadow:"0 2px 12px rgba(0,0,0,0.05)"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"12px"},children:[t.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"14px",background:h.bg,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"22px",flexShrink:0},children:h.emoji}),t.jsxs("div",{style:{flex:1,minWidth:0},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[t.jsx("p",{style:{fontSize:"16px",fontWeight:"700",color:"#1C1C1E",margin:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",maxWidth:"65%"},children:o.description}),t.jsx("span",{style:{fontSize:"12px",color:"#8E8E93",flexShrink:0,marginLeft:"8px"},children:q(o.createdAt)})]}),t.jsxs("p",{style:{fontSize:"13px",color:"#8E8E93",margin:"2px 0 0"},children:[((r=o.paidBy)==null?void 0:r._id)===n?"You":(c=(x=o.paidBy)==null?void 0:x.name)==null?void 0:c.split(" ")[0]," paid ",s,o.amount.toFixed(2)]})]})]}),(d||y)&&t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"12px",paddingTop:"10px",borderTop:"0.5px solid rgba(0,0,0,0.06)"},children:[t.jsx("p",{style:{fontSize:"13px",color:"#8E8E93",margin:0},children:y}),t.jsx("span",{style:{fontSize:"14px",fontWeight:"700",color:f},children:d})]})]})});function ot(){var A,$,I,M;const{id:i}=B(),o=T(),{activeGroup:n,loading:s,fetchGroup:a}=G(),{user:h}=_(),{sendReminder:l}=X(),[p,f]=k.useState(null),[d,C]=k.useState(""),[y,m]=k.useState(!1);k.useEffect(()=>{a(i)},[i]);const S=k.useCallback(async g=>{var E,W;if(p){m(!0);try{await l(p.id,i,Math.abs(p.amount),g),f(null),C("")}catch(L){alert(((W=(E=L.response)==null?void 0:E.data)==null?void 0:W.message)||"Failed")}finally{m(!1)}}},[p,i,l]),e=n,r=(e==null?void 0:e.currencySymbol)||"â‚¹";(A=e==null?void 0:e.balance)==null||A.isSettled;const x=(($=e==null?void 0:e.balance)==null?void 0:$.youOwe)||0,c=((I=e==null?void 0:e.balance)==null?void 0:I.youAreOwed)||0,u=((M=e==null?void 0:e.balance)==null?void 0:M.totalSpend)||0,b=h==null?void 0:h._id;let F="ğŸ˜",j="Everything is chill",v="No debts to settle. You're all good!";return x>0?(F="ğŸ˜¬",j=`You owe ${r}${x.toFixed(0)}`,v="Settle up when you're ready."):c>0&&(F="ğŸ¤‘",j=`You're owed ${r}${c.toFixed(0)}`,v="Nice! Others owe you money."),s&&!e?t.jsxs("div",{style:{background:"#F5F5FA",minHeight:"100dvh",maxWidth:"430px",margin:"0 auto",padding:"0 20px"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"16px 0",justifyContent:"space-between"},children:[t.jsx(w,{width:"32px",height:"32px",borderRadius:"50%"}),t.jsx(w,{width:"130px",height:"20px"}),t.jsx(w,{width:"32px",height:"32px",borderRadius:"50%"})]}),t.jsx(w,{width:"200px",height:"32px",style:{margin:"24px auto 8px"}}),t.jsx(w,{width:"260px",height:"260px",borderRadius:"50%",style:{margin:"24px auto"}}),t.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"24px"},children:[t.jsx(w,{height:"52px",borderRadius:"100px",style:{flex:1}}),t.jsx(w,{height:"52px",borderRadius:"100px",style:{flex:1}})]})]}):!s&&!e?t.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100dvh",fontSize:"17px",color:"#8E8E93"},children:"Group not found"}):t.jsxs("div",{style:{background:"#F5F5FA",minHeight:"100dvh",maxWidth:"430px",margin:"0 auto"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px 0",position:"sticky",top:0,zIndex:10,background:"#F5F5FA"},children:[t.jsx("button",{onClick:()=>o("/groups"),style:{width:"36px",height:"36px",borderRadius:"50%",background:"rgba(0,0,0,0.06)",border:"none",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"18px",color:"#1C1C1E"},children:t.jsx(Y,{})}),t.jsx("h1",{style:{fontSize:"17px",fontWeight:"700",color:"#1C1C1E",margin:0},children:e==null?void 0:e.name}),t.jsx("button",{onClick:()=>o(`/groups/${i}/settings`),style:{width:"36px",height:"36px",borderRadius:"50%",background:"rgba(0,0,0,0.06)",border:"none",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"18px",color:"#1C1C1E"},children:t.jsx(N,{})})]}),t.jsxs("div",{style:{padding:"0 20px 48px",overflowY:"auto",WebkitOverflowScrolling:"touch"},children:[t.jsxs("div",{style:{textAlign:"center",padding:"28px 0 16px"},children:[t.jsxs("h2",{style:{fontSize:"28px",fontWeight:"800",color:"#1C1C1E",letterSpacing:"-0.5px",margin:"0 0 6px"},children:[j," ",F]}),t.jsx("p",{style:{fontSize:"15px",color:"#8E8E93",margin:0},children:v})]}),e&&t.jsx(V,{memberBalances:e.memberBalances,members:e.members||[],totalSpend:u,currSymbol:r,user:h}),t.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"28px",marginBottom:"32px"},children:[t.jsxs("button",{onClick:()=>o(`/groups/${i}/add-expense`),style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"16px 20px",background:"#1C1C1E",color:"#FFFFFF",fontSize:"16px",fontWeight:"700",borderRadius:"100px",border:"none",cursor:"pointer",boxShadow:"0 6px 20px rgba(0,0,0,0.18)"},children:[t.jsx("span",{style:{fontSize:"20px",lineHeight:1},children:"+"}),"Add Expense"]}),t.jsxs("button",{onClick:()=>o(`/groups/${i}/settle`),style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"16px 20px",background:"#fff",color:"#1C1C1E",fontSize:"16px",fontWeight:"700",borderRadius:"100px",border:"2px solid rgba(0,0,0,0.1)",cursor:"pointer",boxShadow:"0 2px 12px rgba(0,0,0,0.06)"},children:[t.jsx("span",{style:{fontSize:"18px"},children:"ğŸ’³"}),"Settle Balance"]})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[t.jsx("h2",{style:{fontSize:"22px",fontWeight:"800",color:"#1C1C1E",margin:0,letterSpacing:"-0.3px"},children:"Group Expenses"}),t.jsx("span",{style:{fontSize:"14px",fontWeight:"600",color:"#6347F5",cursor:"pointer"},onClick:()=>o(`/groups/${i}/settings`),children:"View All"})]}),!(e!=null&&e.expenses)||e.expenses.length===0?t.jsxs("div",{style:{textAlign:"center",padding:"48px 20px",background:"#fff",borderRadius:"24px",boxShadow:"0 2px 12px rgba(0,0,0,0.05)"},children:[t.jsx("div",{style:{fontSize:"56px",marginBottom:"12px"},children:"ğŸ§¾"}),t.jsx("h3",{style:{fontSize:"20px",fontWeight:"700",color:"#1C1C1E",marginBottom:"8px"},children:"No expenses yet"}),t.jsx("p",{style:{fontSize:"15px",color:"#8E8E93",marginBottom:"24px"},children:"Add your first expense to start tracking."}),t.jsx("button",{onClick:()=>o(`/groups/${i}/add-expense`),style:{padding:"14px 28px",background:"#6347F5",color:"#fff",fontSize:"16px",fontWeight:"700",borderRadius:"100px",border:"none",cursor:"pointer",boxShadow:"0 6px 20px rgba(99,71,245,0.3)"},children:"+ Add Expense"})]}):t.jsx("div",{children:e.expenses.map((g,E)=>t.jsx(J,{expense:g,userId:b,currSymbol:r,isLast:E===e.expenses.length-1},g._id))})]}),t.jsx("button",{onClick:()=>o(`/groups/${i}/add-expense`),style:{position:"fixed",bottom:"28px",right:"24px",width:"56px",height:"56px",borderRadius:"50%",background:"linear-gradient(135deg, #6347F5 0%, #4B32CC 100%)",color:"#fff",fontSize:"24px",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 8px 24px rgba(99,71,245,0.4)",zIndex:100},children:"+"}),p&&t.jsx(P,{show:!!p,onClose:()=>f(null),title:`Remind ${p.name}`,variant:"sheet",children:t.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px",padding:"8px 0"},children:[t.jsxs("p",{style:{fontSize:"15px",color:"#8E8E93"},children:["Send a nudge about the ",r,Math.abs(p.amount).toFixed(0)," outstanding."]}),["Hey! Just a reminder about the payment.","Don't forget to settle up!"].map(g=>t.jsxs("button",{onClick:()=>S(g),disabled:y,style:{padding:"12px 16px",textAlign:"left",background:"#F2F2F7",color:"#000",border:"none",borderRadius:"12px",fontSize:"15px",cursor:"pointer"},children:['"',g,'"']},g)),t.jsx("textarea",{value:d,onChange:g=>C(g.target.value),placeholder:"Write your own message...",style:{width:"100%",padding:"12px",borderRadius:"12px",border:"1px solid rgba(0,0,0,0.08)",background:"#F2F2F7",minHeight:"80px",outline:"none",fontSize:"15px",fontFamily:"inherit",resize:"none"}}),t.jsx("button",{className:"btn-primary",onClick:()=>S(d),disabled:y||!d.trim(),children:y?"Sending...":"Send Custom Reminder"})]})})]})}export{ot as default};
