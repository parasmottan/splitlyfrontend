import{c as H,d as I,b as L,u as U,a as J,r as n,j as e}from"./index-D2hiQaAV.js";import{a as K,I as D}from"./index-B02zu7Fg.js";import{u as Q}from"./groupStore-DTKMQI9u.js";const V=H(r=>({expenses:[],loading:!1,error:null,fetchExpenses:async p=>{var a,l;try{r({loading:!0,error:null});const{data:o}=await I.get(`/expenses/${p}`);r({expenses:o,loading:!1})}catch(o){r({error:((l=(a=o.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to fetch expenses",loading:!1})}},addExpense:async p=>{var a,l;try{r({loading:!0,error:null});const{data:o}=await I.post("/expenses",p);return r(c=>({expenses:[o,...c.expenses],loading:!1})),o}catch(o){const c=((l=(a=o.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to add expense";throw r({error:c,loading:!1}),new Error(c)}},clearExpenses:()=>r({expenses:[],error:null})})),R=[{key:"food",label:"Food & Dining",icon:"ðŸ½ï¸"},{key:"transport",label:"Transport",icon:"ðŸš—"},{key:"groceries",label:"Groceries",icon:"ðŸ›’"},{key:"entertainment",label:"Entertainment",icon:"ðŸŽ¬"},{key:"utilities",label:"Utilities",icon:"ðŸ’¡"},{key:"rent",label:"Rent",icon:"ðŸ "},{key:"travel",label:"Travel",icon:"âœˆï¸"},{key:"shopping",label:"Shopping",icon:"ðŸ›ï¸"},{key:"other",label:"Others",icon:"ðŸ“‹"}];function ee(){var F,A,z,B,T;const{id:r}=L(),p=U(),{activeGroup:a,fetchGroup:l}=Q(),{addExpense:o,loading:c}=V(),{user:t}=J(),[v,W]=n.useState(""),[d,q]=n.useState(""),[y,O]=n.useState("food"),[f,k]=n.useState(""),[i,$]=n.useState("equal"),[w,N]=n.useState(!1),[E,C]=n.useState(!1),[j,G]=n.useState({}),[_,x]=n.useState("");n.useEffect(()=>{(!a||a._id!==r)&&l(r)},[r]),n.useEffect(()=>{t&&k(t._id)},[t]);const u=R.find(s=>s.key===y),m=(A=(F=a==null?void 0:a.members)==null?void 0:F.find(s=>s.user._id===f))==null?void 0:A.user,Y=async()=>{if(!v.trim()){x("Description is required");return}if(!d||parseFloat(d)<=0){x("Enter a valid amount");return}const s={groupId:r,description:v.trim(),amount:parseFloat(d),category:y,paidBy:f,splitType:i};if(i==="custom"){const g=Object.entries(j).map(([h,S])=>({user:h,amount:parseFloat(S)||0})).filter(h=>h.amount>0),P=g.reduce((h,S)=>h+S.amount,0);if(Math.abs(P-parseFloat(d))>.01){x(`Split total (â‚¹${P.toFixed(2)}) doesn't match amount (â‚¹${parseFloat(d).toFixed(2)})`);return}s.splits=g}try{await o(s),await l(r),p(`/groups/${r}`,{replace:!0})}catch(g){x(g.message)}};if(!a)return e.jsx("div",{className:"page",children:e.jsx("div",{className:"loading-center",children:e.jsx("div",{className:"spinner"})})});const b=a.currencySymbol||"â‚¹";return e.jsxs("div",{className:"page page-white",style:{padding:"0 20px"},children:[e.jsxs("div",{className:"header",children:[e.jsxs("button",{className:"header-back",onClick:()=>p(-1),children:[e.jsx(K,{})," Back"]}),e.jsx("span",{className:"header-title",children:"Add Expense"}),e.jsx("div",{style:{width:"60px"}})]}),e.jsxs("div",{style:{marginTop:"8px"},children:[_&&e.jsx("div",{style:{background:"var(--red-light)",color:"var(--red)",padding:"12px 16px",borderRadius:"var(--radius-md)",marginBottom:"16px",fontSize:"14px"},children:_}),e.jsxs("div",{style:{textAlign:"center",padding:"24px 0"},children:[e.jsx("p",{style:{fontSize:"14px",color:"var(--text-secondary)",marginBottom:"8px"},children:"Amount"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{style:{fontSize:"36px",fontWeight:"700",color:"var(--text-primary)",marginRight:"4px"},children:b}),e.jsx("input",{type:"number",placeholder:"0.00",value:d,onChange:s=>{q(s.target.value),x("")},style:{fontSize:"36px",fontWeight:"700",border:"none",width:"160px",textAlign:"center",background:"transparent"}})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx("input",{className:"form-input",type:"text",placeholder:"e.g. Dinner at restaurant",value:v,onChange:s=>{W(s.target.value),x("")}})]}),e.jsxs("div",{className:"card",style:{padding:"0 16px",marginBottom:"16px"},children:[e.jsxs("div",{className:"form-row",onClick:()=>N(!w),style:{cursor:"pointer"},children:[e.jsx("span",{className:"form-row-label",children:"Category"}),e.jsxs("span",{className:"form-row-value",children:[u==null?void 0:u.icon," ",u==null?void 0:u.label,e.jsx(D,{style:{fontSize:"16px",color:"var(--gray-400)"}})]})]}),w&&e.jsx("div",{style:{padding:"4px 0",borderTop:"1px solid var(--gray-100)"},children:R.map(s=>e.jsxs("div",{style:{padding:"10px 0",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px",color:y===s.key?"var(--blue)":"var(--text-primary)",fontWeight:y===s.key?"600":"400"},onClick:()=>{O(s.key),N(!1)},children:[e.jsx("span",{children:s.icon})," ",s.label]},s.key))}),e.jsxs("div",{className:"form-row",onClick:()=>C(!E),style:{cursor:"pointer"},children:[e.jsx("span",{className:"form-row-label",children:"Paid by"}),e.jsxs("span",{className:"form-row-value",children:[(m==null?void 0:m._id)===(t==null?void 0:t._id)?"You":(m==null?void 0:m.name)||"Select",e.jsx(D,{style:{fontSize:"16px",color:"var(--gray-400)"}})]})]}),E&&e.jsx("div",{style:{padding:"4px 0",borderTop:"1px solid var(--gray-100)"},children:(z=a.members)==null?void 0:z.map(s=>e.jsx("div",{style:{padding:"10px 0",cursor:"pointer",color:f===s.user._id?"var(--blue)":"var(--text-primary)",fontWeight:f===s.user._id?"600":"400"},onClick:()=>{k(s.user._id),C(!1)},children:s.user._id===(t==null?void 0:t._id)?"You":s.user.name},s.user._id))})]}),e.jsx("h3",{className:"caption",style:{marginBottom:"12px"},children:"SPLIT METHOD"}),e.jsx("div",{style:{display:"flex",marginBottom:"16px",background:"var(--gray-200)",borderRadius:"var(--radius-md)",padding:"2px"},children:["equal","custom"].map(s=>e.jsx("button",{onClick:()=>$(s),style:{flex:1,padding:"10px",background:i===s?"var(--white)":"transparent",borderRadius:i===s?"var(--radius-sm)":"0",color:i===s?"var(--text-primary)":"var(--text-secondary)",fontWeight:i===s?"600":"400",fontSize:"14px",border:"none",cursor:"pointer",boxShadow:i===s?"var(--shadow-sm)":"none",textTransform:"capitalize"},children:s},s))}),i==="custom"&&e.jsx("div",{className:"card",style:{padding:"8px 16px",marginBottom:"16px"},children:(B=a.members)==null?void 0:B.map(s=>e.jsxs("div",{className:"form-row",children:[e.jsx("span",{style:{fontSize:"15px"},children:s.user._id===(t==null?void 0:t._id)?"You":s.user.name}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{style:{color:"var(--text-secondary)"},children:b}),e.jsx("input",{type:"number",placeholder:"0.00",value:j[s.user._id]||"",onChange:g=>G({...j,[s.user._id]:g.target.value}),style:{width:"80px",textAlign:"right",border:"none",fontSize:"16px",fontWeight:"600",background:"transparent"}})]})]},s.user._id))}),i==="equal"&&d&&e.jsxs("p",{style:{fontSize:"14px",color:"var(--text-secondary)",textAlign:"center",marginBottom:"16px"},children:[b,(parseFloat(d)/(((T=a.members)==null?void 0:T.length)||1)).toFixed(2)," per person"]}),e.jsx("button",{className:"btn-primary",onClick:Y,disabled:c,style:{marginBottom:"32px"},children:c?"Adding...":"Add Expense"})]})]})}export{ee as default};
