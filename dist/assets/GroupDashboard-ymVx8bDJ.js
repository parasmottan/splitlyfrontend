import{c as Y,b as F,d as D,u as G,a as T,r as b,j as e}from"./index-7P9_Ad09.js";import{a as _,c as J}from"./index-Bk2wgpwC.js";import{u as P}from"./groupStore-CxgG4Chr.js";import{A as X}from"./Avatar-D6mourTr.js";import{M as q}from"./Modal-CbtNfPkb.js";import{B as K}from"./BottomNav-BXrit2cQ.js";import{S as y}from"./Skeleton-DlW_DT0e.js";import"./index-DHHGR6MN.js";const Q=Y((o,a)=>({notifications:[],unreadCount:0,loading:!1,fetchNotifications:async()=>{o({loading:!0});try{const{data:n}=await F.get("/notifications");o({notifications:n,unreadCount:n.filter(i=>!i.isRead).length,loading:!1})}catch{o({loading:!1})}},markAsRead:async n=>{try{await F.patch(`/notifications/${n}/read`);const i=a().notifications.map(s=>s._id===n?{...s,isRead:!0}:s);o({notifications:i,unreadCount:i.filter(s=>!s.isRead).length})}catch{}},markAllRead:async()=>{try{await F.post("/notifications/read-all");const n=a().notifications.map(i=>({...i,isRead:!0}));o({notifications:n,unreadCount:0})}catch{}},sendReminder:async(n,i,s,x)=>{try{return await F.post("/notifications/remind",{debtorId:n,groupId:i,amount:s,message:x}),!0}catch(d){throw d}}})),U=b.memo(function({member:a,isYou:n,currSymbol:i,isLast:s}){const x=a.user,d=a.net??0,r=a.subtext||"";let h,c;return d>.01?(h=`+ ${i}${Math.abs(d).toFixed(0)}`,c="#34C759"):d<-.01?(h=`- ${i}${Math.abs(d).toFixed(0)}`,c="#FF3B30"):(h=`${i}0`,c="#8E8E93"),e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"14px 16px",borderBottom:s?"none":"0.5px solid rgba(0,0,0,0.06)"},children:[e.jsxs("div",{style:{marginRight:"12px",position:"relative",flexShrink:0},children:[e.jsx(X,{name:x.name}),n&&e.jsx("div",{style:{position:"absolute",bottom:"-1px",right:"-3px",width:"18px",height:"18px",borderRadius:"50%",background:"#007AFF",border:"2.5px solid white",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("svg",{width:"9",height:"9",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M5 13l4 4L19 7",stroke:"white",strokeWidth:"3.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("p",{style:{fontSize:"17px",fontWeight:"600",lineHeight:"22px",color:"#000",margin:0},children:n?"You":x.name}),r&&e.jsx("p",{style:{fontSize:"13px",color:"#8E8E93",margin:"2px 0 0",lineHeight:"18px"},children:r})]}),e.jsx("span",{style:{fontSize:"17px",fontWeight:"700",color:c,flexShrink:0,marginLeft:"12px",letterSpacing:"-0.3px"},children:h})]})});function re(){var R,z,W,E,M,A,B,$,H;const{id:o}=D(),a=G(),{activeGroup:n,loading:i,fetchGroup:s}=P(),{user:x}=T(),{sendReminder:d}=Q(),[r,h]=b.useState(null),[c,v]=b.useState(""),[S,k]=b.useState(!1);b.useEffect(()=>{s(o)},[o]);const w=b.useCallback(async l=>{var g,f;if(r){k(!0);try{await d(r.id,o,Math.abs(r.amount),l),h(null),v("")}catch(u){alert(((f=(g=u.response)==null?void 0:g.data)==null?void 0:f.message)||"Failed to send reminder")}finally{k(!1)}}},[r,o,d]),t=n;if(!i&&!t)return e.jsx("div",{className:"page",style:{background:"#F2F2F7"},children:e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"Group not found"})})});const p=(t==null?void 0:t.currencySymbol)||"â‚¹",m=((R=t==null?void 0:t.pendingSettlements)==null?void 0:R[0])||null,C=((z=t==null?void 0:t.members)==null?void 0:z.map(l=>{var L,O,N;const g=l.user,f=(L=t.memberBalances)==null?void 0:L[g._id],u=(f==null?void 0:f.net)||0,I=g._id===(x==null?void 0:x._id);let j="";return I?j=`Paying for ${((O=t.members)==null?void 0:O.length)||1} share${(((N=t.members)==null?void 0:N.length)||1)>1?"s":""}`:Math.abs(u)<.01?j="Settled up":u>0?j=`Owes you ${p}${Math.abs(u).toFixed(0)}`:j=`You owe ${p}${Math.abs(u).toFixed(0)}`,{...l,net:u,subtext:j,isYou:I}}))||[];return e.jsxs("div",{style:{background:"#F2F2F7",display:"flex",flexDirection:"column",minHeight:"100dvh",maxWidth:"430px",margin:"0 auto",position:"relative"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 16px",paddingTop:"10px",paddingBottom:"8px",minHeight:"44px",background:"#F2F2F7",position:"sticky",top:0,zIndex:10},children:[e.jsxs("button",{onClick:()=>a("/groups"),style:{display:"flex",alignItems:"center",gap:"2px",background:"none",border:"none",cursor:"pointer",padding:0,color:"#007AFF",fontSize:"17px",fontWeight:"400",minWidth:"60px"},children:[e.jsx(_,{style:{fontSize:"24px"}}),e.jsx("span",{children:"Back"})]}),e.jsx("h1",{style:{position:"absolute",left:"50%",transform:"translateX(-50%)",fontSize:"17px",fontWeight:"600",color:"#000",margin:0,maxWidth:"55%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:(t==null?void 0:t.name)||""}),e.jsx("button",{onClick:()=>a(`/groups/${o}/settings`),style:{background:"none",border:"none",cursor:"pointer",padding:0,color:"#007AFF",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(J,{style:{fontSize:"24px"}})})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",WebkitOverflowScrolling:"touch",padding:"0 20px",paddingBottom:"100px"},children:[i&&!t&&e.jsxs("div",{children:[e.jsxs("div",{style:{textAlign:"center",padding:"48px 0 24px"},children:[e.jsx(y,{width:"100px",height:"14px",style:{margin:"0 auto 12px"}}),e.jsx(y,{width:"220px",height:"44px",style:{margin:"0 auto 10px"}}),e.jsx(y,{width:"180px",height:"16px",style:{margin:"0 auto"}})]}),e.jsx(y,{height:"68px",borderRadius:"24px",style:{marginBottom:"36px"}}),e.jsx(y,{width:"160px",height:"22px",style:{marginBottom:"16px"}}),e.jsx(y,{height:"300px",borderRadius:"16px"})]}),t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{textAlign:"center",padding:"44px 0 8px"},children:[e.jsx("p",{style:{fontSize:"16px",color:"#34C759",fontWeight:"500",margin:"0 0 10px",lineHeight:"20px"},children:"Your balance"}),((W=t.balance)==null?void 0:W.youOwe)>0?e.jsxs("p",{style:{fontSize:"40px",fontWeight:"700",color:"#FF3B30",margin:"0 0 10px",lineHeight:"1.05",letterSpacing:"-0.8px"},children:["You owe ",p,t.balance.youOwe.toFixed(0)]}):((E=t.balance)==null?void 0:E.youAreOwed)>0?e.jsxs("p",{style:{fontSize:"40px",fontWeight:"700",color:"#34C759",margin:"0 0 10px",lineHeight:"1.05",letterSpacing:"-0.8px"},children:["You are owed ",p,t.balance.youAreOwed.toFixed(0)]}):e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",margin:"0 0 10px"},children:[e.jsxs("svg",{width:"28",height:"28",viewBox:"0 0 28 28",fill:"none",children:[e.jsx("circle",{cx:"14",cy:"14",r:"14",fill:"#34C759"}),e.jsx("path",{d:"M8 14.5l3.5 3.5L20 10",stroke:"white",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),e.jsx("span",{style:{fontSize:"22px",fontWeight:"700",color:"#34C759"},children:"All Settled"})]}),e.jsxs("p",{style:{fontSize:"15px",color:"#8E8E93",fontWeight:"400",margin:0,lineHeight:"20px"},children:["Total group spend ",e.jsxs("span",{style:{color:"#1C1C1E",fontWeight:"600"},children:[p,(((M=t.balance)==null?void 0:M.totalSpend)||0).toLocaleString("en-IN")]})]})]}),(((A=t.balance)==null?void 0:A.youOwe)>0||m)&&e.jsxs("div",{style:{background:"#EBF2FF",borderRadius:"24px",padding:"14px 16px",display:"flex",alignItems:"center",gap:"12px",margin:"28px 0 0"},children:[e.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"50%",background:"rgba(0,122,255,0.10)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx("span",{style:{fontSize:"20px",fontWeight:"700",color:"#007AFF"},children:p})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("p",{style:{fontSize:"15px",fontWeight:"600",color:"#1C1C1E",margin:0,lineHeight:"20px"},children:[p,((m==null?void 0:m.amount)||((B=t.balance)==null?void 0:B.youOwe)||0).toFixed(0)," pending settlement"]}),e.jsx("p",{style:{fontSize:"13px",color:"#8E8E93",margin:"1px 0 0",lineHeight:"18px"},children:m?`From ${((H=($=m.from)==null?void 0:$.name)==null?void 0:H.split(" ")[0])||"member"}`:"Tap to settle"})]}),e.jsx("button",{onClick:()=>a(`/groups/${o}/settle`),style:{background:"#007AFF",color:"white",fontSize:"15px",fontWeight:"600",padding:"0 20px",height:"36px",borderRadius:"18px",border:"none",cursor:"pointer",flexShrink:0,whiteSpace:"nowrap",transition:"transform 120ms ease-out",display:"flex",alignItems:"center"},children:"Settle Now"})]}),e.jsx("h2",{style:{fontSize:"22px",fontWeight:"700",color:"#1C1C1E",margin:"36px 0 14px",letterSpacing:"-0.3px",lineHeight:"28px"},children:"Member Balances"}),e.jsx("div",{style:{background:"#FFFFFF",borderRadius:"16px",overflow:"hidden",boxShadow:"0 0.5px 1px rgba(0,0,0,0.04), 0 2px 6px rgba(0,0,0,0.03)"},children:C.map((l,g)=>e.jsx(U,{member:l,isYou:l.isYou,currSymbol:p,isLast:g===C.length-1},l.user._id))}),e.jsx("div",{style:{height:"24px"}})]})]}),e.jsx(K,{}),r&&e.jsx(q,{show:!!r,onClose:()=>h(null),title:`Remind ${r.name}`,variant:"sheet",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px",padding:"8px 0"},children:[e.jsxs("p",{style:{fontSize:"15px",color:"#8E8E93"},children:["Send a friendly nudge about the ",p,Math.abs(r.amount).toFixed(0)," outstanding."]}),e.jsx("button",{onClick:()=>w("Hey! Just a reminder about the payment."),disabled:S,style:{padding:"12px 16px",textAlign:"left",background:"#F2F2F7",color:"#000",border:"none",borderRadius:"12px",fontSize:"15px",cursor:"pointer"},children:'"Hey! Just a reminder about the payment."'}),e.jsx("button",{onClick:()=>w("Don't forget to settle up!"),disabled:S,style:{padding:"12px 16px",textAlign:"left",background:"#F2F2F7",color:"#000",border:"none",borderRadius:"12px",fontSize:"15px",cursor:"pointer"},children:`"Don't forget to settle up!"`}),e.jsxs("div",{style:{marginTop:"4px"},children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"600",color:"#8E8E93",display:"block",marginBottom:"8px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Custom Message"}),e.jsx("textarea",{value:c,onChange:l=>v(l.target.value),placeholder:"Write your own message...",style:{width:"100%",padding:"12px",borderRadius:"12px",border:"1px solid rgba(0,0,0,0.08)",background:"#F2F2F7",minHeight:"80px",outline:"none",fontSize:"15px",fontFamily:"inherit",resize:"none",transition:"border-color 200ms ease, box-shadow 200ms ease"}})]}),e.jsx("button",{className:"btn-primary",onClick:()=>w(c),disabled:S||!c.trim(),style:{marginTop:"4px"},children:S?"Sending...":"Send Custom Reminder"})]})})]})}export{re as default};
