import{c as _,b as F,d as D,u as T,a as O,r as a,j as e}from"./index-B3lqKPvk.js";import{u as $}from"./groupStore-BYNz21HU.js";import{A as q}from"./Avatar-yNoXF_l8.js";const L=_(n=>({expenses:[],loading:!1,error:null,fetchExpenses:async g=>{var r,l;try{n({loading:!0,error:null});const{data:i}=await F.get(`/expenses/${g}`);n({expenses:i,loading:!1})}catch(i){n({error:((l=(r=i.response)==null?void 0:r.data)==null?void 0:l.message)||"Failed to fetch expenses",loading:!1})}},addExpense:async g=>{var r,l;try{n({loading:!0,error:null});const{data:i}=await F.post("/expenses",g);return n(p=>({expenses:[i,...p.expenses],loading:!1})),i}catch(i){const p=((l=(r=i.response)==null?void 0:r.data)==null?void 0:l.message)||"Failed to add expense";throw n({error:p,loading:!1}),new Error(p)}},clearExpenses:()=>n({expenses:[],error:null})})),C=[{key:"food",label:"Food",emoji:"ðŸ”",color:"#FF9500",bg:"rgba(255,149,0,0.12)"},{key:"drinks",label:"Drinks",emoji:"ðŸº",color:"#5AC8FA",bg:"rgba(90,200,250,0.12)"},{key:"transport",label:"Ride",emoji:"ðŸš•",color:"#FFCC00",bg:"rgba(255,204,0,0.12)"},{key:"rent",label:"Rent",emoji:"ðŸ ",color:"#FF3B30",bg:"rgba(255,59,48,0.12)"},{key:"entertainment",label:"Fun",emoji:"ðŸŽ¬",color:"#AF52DE",bg:"rgba(175,82,222,0.12)"},{key:"groceries",label:"Market",emoji:"ðŸ›’",color:"#34C759",bg:"rgba(52,199,89,0.12)"},{key:"travel",label:"Travel",emoji:"âœˆï¸",color:"#007AFF",bg:"rgba(0,122,255,0.12)"},{key:"other",label:"Other",emoji:"ðŸ’¸",color:"#8E8E93",bg:"rgba(142,142,147,0.12)"}];function P(){var w;const{id:n}=D(),g=T(),{activeGroup:r,fetchGroup:l}=$(),{addExpense:i,loading:p}=L(),{user:s}=O(),[f,z]=a.useState(""),[d,W]=a.useState(""),[b,A]=a.useState("food"),[m,k]=a.useState(""),[u,I]=a.useState("equal"),[j,R]=a.useState({}),[E,h]=a.useState("");a.useEffect(()=>{(!r||r._id!==n)&&l(n)},[n]),a.useEffect(()=>{s&&k(s._id)},[s]),C.find(t=>t.key===b)||C[0];const B=async()=>{if(!f.trim()){h("Description is required");return}if(!d||parseFloat(d)<=0){h("Enter a valid amount");return}const t={groupId:n,description:f.trim(),amount:parseFloat(d),category:b,paidBy:m,splitType:u};if(u==="custom"){const o=Object.entries(j).map(([x,v])=>({user:x,amount:parseFloat(v)||0})).filter(x=>x.amount>0),c=o.reduce((x,v)=>x+v.amount,0);if(Math.abs(c-parseFloat(d))>.01){h(`Split total (â‚¹${c.toFixed(2)}) doesn't match amount (â‚¹${parseFloat(d).toFixed(2)})`);return}t.splits=o}try{await i(t),await l(n),g(`/groups/${n}`,{replace:!0})}catch(o){h(o.message)}};if(!r)return e.jsx("div",{style:{background:"#F5F3F0",minHeight:"100dvh",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"12px"},children:e.jsx("div",{style:{width:"32px",height:"32px",border:"3px solid var(--blue)",borderTopColor:"transparent",borderRadius:"50%",animation:"spin 0.8s linear infinite"}})})});const S=r.currencySymbol||"$",y=r.members||[];return(w=y.find(t=>t.user._id===m))==null||w.user,e.jsxs("div",{style:{background:"#F5F3F0",minHeight:"100dvh",display:"flex",flexDirection:"column",maxWidth:"430px",margin:"0 auto"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"center",padding:"12px 0 0"},children:e.jsx("div",{style:{width:"36px",height:"4px",borderRadius:"2px",background:"rgba(0,0,0,0.15)"}})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 24px 8px"},children:[e.jsx("button",{onClick:()=>g(-1),style:{background:"none",border:"none",fontSize:"15px",fontWeight:"600",color:"#8E8E93",cursor:"pointer"},children:"Cancel"}),e.jsx("h2",{style:{fontSize:"17px",fontWeight:"700",color:"#1C1C1E"},children:"New Expense"}),e.jsx("div",{style:{width:"48px"}})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"0 24px 40px"},children:[E&&e.jsx("div",{style:{background:"rgba(255,59,48,0.1)",color:"#DC2626",padding:"12px 16px",borderRadius:"16px",marginBottom:"16px",fontSize:"15px",border:"1px solid rgba(220,38,38,0.2)"},children:E}),e.jsxs("div",{style:{textAlign:"center",padding:"24px 0 20px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:[e.jsx("span",{style:{fontSize:"32px",fontWeight:"300",color:"#8E8E93",marginRight:"4px"},children:S}),e.jsx("input",{type:"number",placeholder:"0.00",value:d,onChange:t=>{W(t.target.value),h("")},style:{fontSize:"64px",fontWeight:"800",border:"none",width:"200px",textAlign:"center",background:"transparent",outline:"none",color:"#0F1130",letterSpacing:"-2px"}})]}),e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"8px 16px",background:"rgba(255,255,255,0.7)",borderRadius:"100px",marginTop:"12px",cursor:"pointer",boxShadow:"0 2px 8px rgba(0,0,0,0.06)"},children:[e.jsx("span",{style:{fontSize:"15px",fontWeight:"600",color:"#1C1C1E"},children:"USD"}),e.jsx("span",{style:{color:"#8E8E93",fontSize:"14px"},children:"â–¾"})]})]}),e.jsx("div",{style:{textAlign:"center",marginBottom:"28px"},children:e.jsx("input",{type:"text",placeholder:"What's this for?",value:f,onChange:t=>{z(t.target.value),h("")},style:{background:"transparent",border:"none",outline:"none",fontSize:"20px",color:f?"#1C1C1E":"#C7C7CC",textAlign:"center",width:"100%",fontWeight:"500"}})}),e.jsx("p",{style:{fontSize:"12px",fontWeight:"700",color:"#8E8E93",letterSpacing:"0.8px",textTransform:"uppercase",marginBottom:"12px"},children:"CATEGORY"}),e.jsx("div",{style:{display:"flex",gap:"10px",overflowX:"auto",paddingBottom:"4px",marginBottom:"28px",WebkitOverflowScrolling:"touch"},children:C.map(t=>{const o=b===t.key;return e.jsxs("button",{onClick:()=>A(t.key),style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"6px",flexShrink:0,padding:"0",background:"none",border:"none",cursor:"pointer"},children:[e.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"50%",background:o?t.bg:"rgba(255,255,255,0.7)",border:o?`3px solid ${t.color}`:"3px solid transparent",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"28px",transition:"all 150ms ease",boxShadow:o?`0 4px 16px ${t.color}30`:"0 2px 8px rgba(0,0,0,0.06)"},children:t.emoji}),e.jsx("span",{style:{fontSize:"12px",fontWeight:o?"700":"500",color:o?t.color:"#8E8E93"},children:t.label})]},t.key)})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[e.jsx("p",{style:{fontSize:"12px",fontWeight:"700",color:"#8E8E93",letterSpacing:"0.8px",textTransform:"uppercase"},children:"WHO PAID?"}),e.jsx("span",{style:{fontSize:"14px",fontWeight:"700",color:"var(--blue)",cursor:"pointer"},children:"Split options"})]}),e.jsx("div",{style:{display:"flex",gap:"12px",overflowX:"auto",marginBottom:"28px",WebkitOverflowScrolling:"touch"},children:y.map(t=>{var x;const o=t.user._id===(s==null?void 0:s._id),c=m===t.user._id;return e.jsxs("button",{onClick:()=>k(t.user._id),style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"6px",flexShrink:0,background:"none",border:"none",cursor:"pointer",position:"relative"},children:[e.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"50%",overflow:"hidden",border:c?"3px solid var(--blue)":"3px solid transparent",filter:c?"none":"grayscale(100%)",transition:"all 150ms ease"},children:e.jsx(q,{name:t.user.name,style:{width:"100%",height:"100%",fontSize:"22px"}})}),c&&e.jsx("div",{style:{position:"absolute",bottom:"22px",right:"-2px",width:"22px",height:"22px",borderRadius:"50%",background:"var(--blue)",border:"2px solid #fff",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("svg",{width:"10",height:"10",viewBox:"0 0 10 10",children:e.jsx("path",{d:"M2 5L4.2 7.5L8 3",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("span",{style:{fontSize:"12px",fontWeight:"600",color:c?"var(--blue)":"#8E8E93"},children:o?"You":(x=t.user.name)==null?void 0:x.split(" ")[0]})]},t.user._id)})}),e.jsxs("div",{style:{background:"rgba(255,255,255,0.85)",borderRadius:"20px",padding:"16px 20px",marginBottom:"24px",boxShadow:"0 4px 16px rgba(0,0,0,0.06)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:u==="custom"?"16px":"0"},children:[e.jsx("span",{style:{fontSize:"16px",fontWeight:"600",color:"#1C1C1E"},children:"Split Breakdown"}),e.jsx("button",{onClick:()=>I(t=>t==="equal"?"custom":"equal"),style:{padding:"5px 12px",background:"rgba(52,199,89,0.1)",borderRadius:"8px",border:"none",cursor:"pointer"},children:e.jsx("span",{style:{fontSize:"12px",fontWeight:"700",color:"#34C759",letterSpacing:"0.5px"},children:u==="equal"?"EQUALLY":"CUSTOM"})})]}),u==="custom"&&y.map(t=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0",borderTop:"0.5px solid var(--gray-200)"},children:[e.jsx("span",{style:{fontSize:"16px",color:"#1C1C1E"},children:t.user._id===(s==null?void 0:s._id)?"You":t.user.name}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{style:{color:"#8E8E93"},children:S}),e.jsx("input",{type:"number",placeholder:"0.00",value:j[t.user._id]||"",onChange:o=>R({...j,[t.user._id]:o.target.value}),style:{width:"80px",textAlign:"right",border:"none",fontSize:"17px",fontWeight:"600",background:"transparent",outline:"none"}})]})]},t.user._id)),u==="equal"&&d&&e.jsxs("p",{style:{fontSize:"14px",color:"#8E8E93",marginTop:"4px"},children:[S,(parseFloat(d)/(y.length||1)).toFixed(2)," per person"]})]}),e.jsx("button",{onClick:B,disabled:p,style:{width:"100%",padding:"18px 24px",background:"linear-gradient(135deg, #6347F5 0%, #4B32CC 100%)",color:"white",fontSize:"17px",fontWeight:"700",borderRadius:"100px",border:"none",cursor:"pointer",boxShadow:"0 8px 24px rgba(99,71,245,0.35)",opacity:p?.7:1},children:p?"Adding...":"Add it"})]})]})}export{P as default};
