import{b as T,u as M,a as O,r as m,j as e}from"./index-BEeK-z6j.js";import{a as D,j as L,k as G}from"./index-DyR_dC7_.js";import{d as Y}from"./index-BVKHewpk.js";import{u as E}from"./groupStore-BkZNNHd4.js";import{u as H}from"./notificationStore-CPJ7SJaq.js";import{A as P}from"./Avatar-qJ0UtHlh.js";import{M as J}from"./Modal-Cvv6mUMT.js";import{S as x}from"./Skeleton-DX-qZHku.js";function te(){var z,N,R,A;const{id:l}=T(),h=M(),{activeGroup:$,loading:S,fetchGroup:F}=E(),{user:n}=O(),{sendReminder:w}=H(),[p,_]=m.useState("expenses"),[d,f]=m.useState(null),[j,k]=m.useState(""),[u,C]=m.useState(!1);m.useEffect(()=>{F(l)},[l]);const v=m.useCallback(async t=>{var r,i;if(d){C(!0);try{await w(d.id,l,Math.abs(d.amount),t),f(null),k(""),alert("Reminder sent!")}catch(a){alert(((i=(r=a.response)==null?void 0:r.data)==null?void 0:i.message)||"Failed to send reminder")}finally{C(!1)}}},[d,l,w]),s=$;if(!S&&!s)return e.jsx("div",{className:"page",children:e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"Group not found"})})});const o=(s==null?void 0:s.currencySymbol)||"â‚¹";return e.jsxs("div",{className:"page page-white",style:{display:"flex",flexDirection:"column",minHeight:"100dvh"},children:[e.jsxs("div",{className:"header",style:{padding:"12px 20px"},children:[e.jsxs("button",{className:"header-back",onClick:()=>h("/groups"),children:[e.jsx(D,{style:{fontSize:"20px"}})," Groups"]}),e.jsx("span",{className:"header-title",children:(s==null?void 0:s.name)||"Loading..."}),e.jsx("button",{className:"header-action",onClick:()=>h(`/groups/${l}/settings`),style:{fontSize:"17px"},children:"Settings"})]}),e.jsxs("div",{style:{padding:"0 20px",flex:1,overflowY:"auto",paddingBottom:"32px"},children:[S&&!s&&e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("div",{className:"card",style:{padding:"24px",margin:"8px 0 16px",textAlign:"center"},children:[e.jsx(x,{width:"100px",height:"13px",style:{margin:"0 auto 8px"}}),e.jsx(x,{width:"180px",height:"36px",style:{margin:"0 auto 8px"}}),e.jsx(x,{width:"140px",height:"14px",style:{margin:"0 auto"}})]}),e.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"20px"},children:[e.jsx(x,{height:"48px",borderRadius:"14px",style:{flex:1}}),e.jsx(x,{height:"48px",borderRadius:"14px",style:{flex:1}})]}),[1,2,3].map(t=>e.jsx("div",{className:"card",style:{marginBottom:"8px",padding:"14px 16px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx(x,{width:"40px",height:"40px",borderRadius:"10px"}),e.jsxs("div",{style:{flex:1},children:[e.jsx(x,{width:"120px",height:"16px",style:{marginBottom:"8px"}}),e.jsx(x,{width:"80px",height:"13px"})]})]})},t))]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"card",style:{padding:"24px",margin:"8px 0 16px",textAlign:"center"},children:[e.jsx("p",{style:{fontSize:"13px",color:"var(--text-secondary)",fontWeight:"500",marginBottom:"4px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Your balance"}),((z=s.balance)==null?void 0:z.youOwe)>0?e.jsxs("p",{style:{fontSize:"34px",fontWeight:"700",color:"var(--red)",letterSpacing:"-0.5px"},children:["You owe ",o,s.balance.youOwe.toFixed(0)]}):((N=s.balance)==null?void 0:N.youAreOwed)>0?e.jsxs("p",{style:{fontSize:"34px",fontWeight:"700",color:"var(--green)",letterSpacing:"-0.5px"},children:["You are owed ",o,s.balance.youAreOwed.toFixed(0)]}):e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[e.jsx("div",{style:{width:"24px",height:"24px",borderRadius:"50%",background:"var(--green)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("svg",{width:"14",height:"14",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M5 13l4 4L19 7",stroke:"white",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("span",{style:{fontSize:"17px",fontWeight:"600",color:"var(--green)"},children:"All Settled"})]}),e.jsxs("p",{style:{fontSize:"15px",color:"var(--text-secondary)",marginTop:"4px"},children:["Total group spend ",o,(((R=s.balance)==null?void 0:R.totalSpend)||0).toFixed(2)]})]}),e.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"20px"},children:[e.jsxs("button",{className:"btn-primary",style:{flex:1,padding:"14px",gap:"8px",borderRadius:"14px"},onClick:()=>h(`/groups/${l}/add-expense`),disabled:s.archived,children:[e.jsx(L,{style:{fontSize:"20px"}}),"Add Expense"]}),e.jsxs("button",{style:{flex:1,padding:"14px",background:"var(--white)",color:"var(--blue)",fontWeight:"600",fontSize:"15px",borderRadius:"14px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",boxShadow:"var(--shadow-sm)",border:"0.5px solid rgba(0,0,0,0.04)",cursor:"pointer",transition:"transform 120ms ease-out"},onClick:()=>h(`/groups/${l}/settle`),disabled:s.archived,children:[e.jsx(Y,{style:{fontSize:"20px"}}),"Settle Up"]})]}),e.jsx("div",{style:{display:"flex",marginBottom:"16px",background:"var(--gray-200)",borderRadius:"10px",padding:"2px"},children:["expenses","members"].map(t=>e.jsx("button",{onClick:()=>_(t),style:{flex:1,padding:"10px",background:p===t?"var(--white)":"transparent",borderRadius:p===t?"8px":"0",color:p===t?"var(--text-primary)":"var(--text-secondary)",fontWeight:p===t?"600":"400",fontSize:"15px",border:"none",cursor:"pointer",boxShadow:p===t?"var(--shadow-sm)":"none",textTransform:"capitalize",transition:"all 200ms ease-out"},children:t},t))}),p==="expenses"&&e.jsx("div",{children:!s.expenses||s.expenses.length===0?e.jsxs("div",{className:"empty-state",style:{padding:"40px 20px"},children:[e.jsx("div",{className:"empty-state-icon",children:e.jsx(G,{style:{fontSize:"32px"}})}),e.jsx("h3",{className:"empty-state-title",children:"No expenses yet"}),e.jsx("p",{className:"empty-state-text",children:"Add your first expense to start tracking."}),!s.archived&&e.jsx("button",{className:"btn-primary",style:{maxWidth:"220px"},onClick:()=>h(`/groups/${l}/add-expense`),children:"+ Add Expense"})]}):s.expenses.map(t=>{var g,y,B;const r=((g=t.paidBy)==null?void 0:g._id)===(n==null?void 0:n._id),i=(y=t.splits)==null?void 0:y.find(W=>{var I;return W.user===(n==null?void 0:n._id)||((I=W.user)==null?void 0:I._id)===(n==null?void 0:n._id)});let a,c;r?(a=`+${o}${(t.amount-((i==null?void 0:i.amount)||0)).toFixed(2)}`,c="var(--green)"):i?(a=`-${o}${i.amount.toFixed(2)}`,c="var(--red)"):(a=`${o}0.00`,c="var(--text-secondary)");const b=(t.category||"other").charAt(0).toUpperCase();return e.jsx("div",{className:"card animate-fade-in",style:{marginBottom:"8px",padding:"14px 16px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"10px",background:"var(--gray-100)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"600",color:"var(--text-secondary)"},children:b}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontWeight:"600",fontSize:"17px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.description}),e.jsx("span",{style:{fontWeight:"600",fontSize:"17px",color:c,flexShrink:0,marginLeft:"8px"},children:a})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"4px"},children:[e.jsxs("span",{style:{fontSize:"13px",color:"var(--text-secondary)"},children:[r?"You paid":`${((B=t.paidBy)==null?void 0:B.name)||"Someone"} paid`," ",o,t.amount.toFixed(2)]}),e.jsx("span",{style:{fontSize:"13px",color:"var(--text-tertiary)"},children:new Date(t.createdAt).toLocaleDateString("en-IN",{day:"numeric",month:"short"})})]})]})]})},t._id)})}),p==="members"&&e.jsx("div",{children:(A=s.members)==null?void 0:A.map(t=>{var g,y;const r=t.user,i=(g=s.memberBalances)==null?void 0:g[r._id],a=(i==null?void 0:i.net)||0,c=a<-.01,b=((y=s.balance)==null?void 0:y.youAreOwed)>0&&r._id!==(n==null?void 0:n._id)&&c;return e.jsx("div",{className:"card",style:{marginBottom:"8px",padding:"14px 16px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx(P,{name:r.name,size:"sm"}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{style:{fontWeight:"600",fontSize:"17px"},children:[r._id===(n==null?void 0:n._id)?"You":r.name,t.role==="owner"&&e.jsx("span",{style:{fontSize:"12px",color:"var(--blue)",marginLeft:"6px"},children:"Owner"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[e.jsx("span",{style:{fontWeight:"600",fontSize:"15px",color:a>0?"var(--green)":a<0?"var(--red)":"var(--text-secondary)"},children:a>0?`+${o}${a.toFixed(2)}`:a<0?`-${o}${Math.abs(a).toFixed(2)}`:"Settled"}),b&&!s.archived&&e.jsx("button",{onClick:()=>f({id:r._id,name:r.name,amount:a}),style:{border:"none",background:"var(--blue-light)",color:"var(--blue)",fontSize:"13px",fontWeight:"600",padding:"4px 12px",borderRadius:"8px",marginTop:"6px",cursor:"pointer",transition:"transform 120ms ease-out"},children:"Remind"})]})]}),e.jsxs("span",{style:{fontSize:"13px",color:"var(--text-secondary)"},children:["Paid: ",o,((i==null?void 0:i.paid)||0).toFixed(2)]})]})]})},r._id)})}),d&&e.jsx(J,{show:!!d,onClose:()=>f(null),title:`Remind ${d.name}`,variant:"sheet",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px",padding:"8px 0"},children:[e.jsxs("p",{style:{fontSize:"15px",color:"var(--text-secondary)"},children:["Send a friendly nudge to ",d.name," about the ",o,Math.abs(d.amount).toFixed(2)," outstanding balance."]}),e.jsx("button",{className:"btn-secondary",onClick:()=>v("Hey! Just a reminder about the payment."),disabled:u,style:{padding:"12px",textAlign:"left",background:"var(--gray-50)",color:"var(--text-primary)",justifyContent:"flex-start",borderRadius:"12px"},children:'"Hey! Just a reminder about the payment."'}),e.jsx("button",{className:"btn-secondary",onClick:()=>v("Don't forget to settle up!"),disabled:u,style:{padding:"12px",textAlign:"left",background:"var(--gray-50)",color:"var(--text-primary)",justifyContent:"flex-start",borderRadius:"12px"},children:`"Don't forget to settle up!"`}),e.jsxs("div",{style:{marginTop:"8px"},children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"600",color:"var(--text-secondary)",display:"block",marginBottom:"8px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Custom Message"}),e.jsx("textarea",{value:j,onChange:t=>k(t.target.value),placeholder:"Write your own message...",style:{width:"100%",padding:"12px",borderRadius:"12px",border:"1px solid var(--gray-200)",background:"var(--gray-50)",minHeight:"80px",outline:"none",fontSize:"15px",fontFamily:"inherit",resize:"none",transition:"border-color 200ms ease, box-shadow 200ms ease"}})]}),e.jsx("button",{className:"btn-primary",onClick:()=>v(j),disabled:u||!j.trim(),style:{marginTop:"8px"},children:u?"Sending...":"Send Custom Reminder"})]})})]})]})]})}export{te as default};
