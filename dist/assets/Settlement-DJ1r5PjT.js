import{c as C,d as m,b as A,u as z,r as p,j as e}from"./index-D2hiQaAV.js";import{a as E,d as B}from"./index-B02zu7Fg.js";import{u as F}from"./groupStore-DTKMQI9u.js";import{A as v}from"./Avatar-CKEBuCLQ.js";import{M}from"./Modal-KTUvGfvR.js";const T=C(s=>({settlementData:null,loading:!1,error:null,fetchSettlements:async o=>{var a,r;try{s({loading:!0,error:null});const{data:l}=await m.get(`/settlements/${o}`);return s({settlementData:l,loading:!1}),l}catch(l){s({error:((r=(a=l.response)==null?void 0:a.data)==null?void 0:r.message)||"Failed to fetch settlements",loading:!1})}},settleAll:async o=>{var a,r;try{s({loading:!0,error:null});const{data:l}=await m.post(`/settlements/${o}/settle-all`);return s({loading:!1}),l}catch(l){const i=((r=(a=l.response)==null?void 0:a.data)==null?void 0:r.message)||"Failed to settle";throw s({error:i,loading:!1}),new Error(i)}},settleSingle:async(o,a)=>{var r,l;try{const{data:i}=await m.post(`/settlements/${o}/settle-single`,a);return i}catch(i){throw new Error(((l=(r=i.response)==null?void 0:r.data)==null?void 0:l.message)||"Failed to settle")}},clearSettlements:()=>s({settlementData:null,error:null})}));function P(){var u,y;const{id:s}=A(),o=z(),{settlementData:a,loading:r,fetchSettlements:l,settleAll:i,settleSingle:w}=T(),{fetchGroup:x}=F(),[b,c]=p.useState(!1),[h,g]=p.useState(!1);p.useEffect(()=>{l(s)},[s]);const N=async()=>{g(!0);try{await i(s),await x(s),o(`/groups/${s}/settled`,{replace:!0})}catch{}g(!1)},k=async n=>{try{await w(s,{fromUser:n.from._id,toUser:n.to._id,amount:n.amount}),l(s),x(s)}catch{}};if(r&&!a)return e.jsx("div",{className:"page",children:e.jsx("div",{className:"loading-center",children:e.jsx("div",{className:"spinner"})})});const t=a,d=(t==null?void 0:t.currencySymbol)||"â‚¹";return e.jsxs("div",{className:"page page-white",style:{padding:"0 20px"},children:[e.jsxs("div",{className:"header",children:[e.jsxs("button",{className:"header-back",onClick:()=>o(-1),children:[e.jsx(E,{})," Back"]}),e.jsx("span",{className:"header-title",children:"Settle Up"}),e.jsx("div",{style:{width:"60px"}})]}),e.jsxs("div",{style:{textAlign:"center",padding:"24px 0"},children:[e.jsx("p",{style:{fontSize:"14px",color:"var(--text-secondary)",marginBottom:"4px"},children:"Total to settle"}),e.jsxs("p",{style:{fontSize:"36px",fontWeight:"800"},children:[d,((t==null?void 0:t.totalToSettle)||0).toFixed(2)]}),e.jsxs("p",{style:{fontSize:"14px",color:"var(--text-secondary)",marginTop:"4px"},children:[(t==null?void 0:t.pendingCount)||0," payment",(t==null?void 0:t.pendingCount)!==1?"s":""," needed"]})]}),((u=t==null?void 0:t.transfers)==null?void 0:u.length)>0?e.jsxs("div",{children:[e.jsx("h3",{className:"caption",style:{marginBottom:"12px"},children:"OPTIMIZED PAYMENTS"}),t.transfers.map((n,f)=>{var j,S;return e.jsx("div",{className:"card animate-fade-in",style:{marginBottom:"10px",padding:"16px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx(v,{name:n.from.name,size:"sm"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",flex:"0 0 auto"},children:[e.jsx("span",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:"pays"}),e.jsx(B,{style:{color:"var(--blue)",fontSize:"18px"}})]}),e.jsx(v,{name:n.to.name,size:"sm"}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("p",{style:{fontWeight:"600",fontSize:"16px"},children:[d,n.amount.toFixed(2)]}),e.jsxs("p",{style:{fontSize:"12px",color:"var(--text-secondary)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[(j=n.from.name)==null?void 0:j.split(" ")[0]," â†’ ",(S=n.to.name)==null?void 0:S.split(" ")[0]]})]}),e.jsx("button",{onClick:()=>k(n),style:{padding:"8px 16px",background:"var(--blue-light)",color:"var(--blue)",borderRadius:"var(--radius-full)",fontWeight:"600",fontSize:"13px",border:"none",cursor:"pointer"},children:"Settle"})]})},f)})]}):e.jsxs("div",{className:"empty-state",style:{padding:"40px 20px"},children:[e.jsx("div",{className:"empty-state-icon",children:"âœ…"}),e.jsx("h3",{className:"empty-state-title",children:"All settled!"}),e.jsx("p",{className:"empty-state-text",children:"Everyone's even. Great teamwork!"})]}),((y=t==null?void 0:t.transfers)==null?void 0:y.length)>0&&e.jsx("button",{className:"btn-primary",onClick:()=>c(!0),style:{marginTop:"24px",marginBottom:"32px"},children:"Settle All Balances"}),e.jsx(M,{show:b,icon:"ðŸ’¸",title:"Settle All?",message:`Mark all ${(t==null?void 0:t.pendingCount)||0} payment(s) totalling ${d}${((t==null?void 0:t.totalToSettle)||0).toFixed(2)} as settled?`,onClose:()=>c(!1),children:e.jsx("div",{className:"modal-actions",children:e.jsxs("div",{className:"modal-actions-row",children:[e.jsx("button",{onClick:()=>c(!1),style:{background:"var(--gray-100)",color:"var(--text-primary)"},children:"Cancel"}),e.jsx("button",{onClick:N,disabled:h,style:{background:"var(--blue)",color:"white"},children:h?"Settling...":"Confirm"})]})})})]})}export{P as default};
