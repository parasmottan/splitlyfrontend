import{c as C,b as h,d as E,u as F,r as p,j as e}from"./index-7P9_Ad09.js";import{u as z}from"./groupStore-CxgG4Chr.js";import{A as k}from"./Avatar-D6mourTr.js";import{M as A}from"./Modal-CbtNfPkb.js";import{S as d}from"./Skeleton-DlW_DT0e.js";const W=C(n=>({settlementData:null,loading:!1,error:null,fetchSettlements:async i=>{var o,r;try{n({loading:!0,error:null});const{data:l}=await h.get(`/settlements/${i}`);return n({settlementData:l,loading:!1}),l}catch(l){n({error:((r=(o=l.response)==null?void 0:o.data)==null?void 0:r.message)||"Failed to fetch settlements",loading:!1})}},settleAll:async i=>{var o,r;try{n({loading:!0,error:null});const{data:l}=await h.post(`/settlements/${i}/settle-all`);return n({loading:!1}),l}catch(l){const a=((r=(o=l.response)==null?void 0:o.data)==null?void 0:r.message)||"Failed to settle";throw n({error:a,loading:!1}),new Error(a)}},settleSingle:async(i,o)=>{var r,l;try{const{data:a}=await h.post(`/settlements/${i}/settle-single`,o);return a}catch(a){throw new Error(((l=(r=a.response)==null?void 0:r.data)==null?void 0:l.message)||"Failed to settle")}},clearSettlements:()=>n({settlementData:null,error:null})}));function D(){var y,S;const{id:n}=E(),i=F(),{settlementData:o,loading:r,fetchSettlements:l,settleAll:a,settleSingle:f}=W(),{fetchGroup:c}=z(),[v,x]=p.useState(!1),[m,u]=p.useState(!1);p.useEffect(()=>{l(n)},[n]);const w=p.useCallback(async()=>{u(!0);try{await a(n),await c(n),i(`/groups/${n}/settled`,{replace:!0})}catch{}u(!1)},[n,a,c,i]);if(p.useCallback(async s=>{try{await f(n,{fromUser:s.from._id,toUser:s.to._id,amount:s.amount}),l(n),c(n)}catch{}},[n,f,l,c]),r&&!o)return e.jsxs("div",{style:{background:"#fff",minHeight:"100dvh",padding:"0 24px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"16px 0",position:"relative"},children:[e.jsx("button",{onClick:()=>i(-1),style:{background:"none",border:"none",cursor:"pointer",color:"#1C1C1E",fontSize:"20px"},children:"â†"}),e.jsx("span",{style:{position:"absolute",left:"50%",transform:"translateX(-50%)",fontSize:"17px",fontWeight:"700"},children:"Settle Balance"})]}),e.jsxs("div",{style:{textAlign:"center",padding:"40px 0 32px"},children:[e.jsx(d,{width:"220px",height:"60px",style:{margin:"0 auto 12px"}}),e.jsx(d,{width:"180px",height:"32px",borderRadius:"100px",style:{margin:"0 auto"}})]}),[1,2,3].map(s=>e.jsxs("div",{style:{background:"#F9F9FB",borderRadius:"16px",padding:"16px",marginBottom:"10px",display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx(d,{width:"48px",height:"48px",borderRadius:"50%"}),e.jsxs("div",{style:{flex:1},children:[e.jsx(d,{width:"55%",height:"16px",style:{marginBottom:"6px"}}),e.jsx(d,{width:"70%",height:"13px"})]}),e.jsx(d,{width:"70px",height:"23px"})]},s))]});const t=o,g=(t==null?void 0:t.currencySymbol)||"$";return e.jsxs("div",{style:{background:"#fff",minHeight:"100dvh",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"16px 24px",position:"relative"},children:[e.jsx("button",{onClick:()=>i(-1),style:{background:"none",border:"none",cursor:"pointer",color:"#1C1C1E",fontSize:"20px",zIndex:1},children:"â†"}),e.jsx("span",{style:{position:"absolute",left:"50%",transform:"translateX(-50%)",fontSize:"17px",fontWeight:"700",color:"#1C1C1E"},children:"Settle Balance"}),e.jsx("button",{style:{background:"none",border:"none",cursor:"pointer",color:"var(--blue)",fontSize:"15px",fontWeight:"600",zIndex:1,marginLeft:"auto"},children:"Help"})]}),e.jsxs("div",{style:{textAlign:"center",padding:"32px 24px 28px",background:"linear-gradient(160deg, #F8F6FF 0%, #F0EEFF 100%)"},children:[e.jsxs("div",{style:{marginBottom:"6px"},children:[e.jsx("span",{style:{fontSize:"20px",fontWeight:"700",color:"#8E8E93",verticalAlign:"super",marginRight:"2px"},children:g}),e.jsx("span",{style:{fontSize:"60px",fontWeight:"800",color:"#1C1C1E",letterSpacing:"-2px"},children:Math.floor((t==null?void 0:t.totalToSettle)||0).toLocaleString()}),e.jsxs("span",{style:{fontSize:"28px",fontWeight:"600",color:"#8E8E93"},children:[".",(((t==null?void 0:t.totalToSettle)||0)%1).toFixed(2).slice(2)]})]}),e.jsx("div",{style:{display:"inline-flex",alignItems:"center",padding:"8px 20px",background:"rgba(255,59,48,0.1)",borderRadius:"100px",border:"1px solid rgba(255,59,48,0.2)"},children:e.jsx("span",{style:{fontSize:"14px",fontWeight:"600",color:"#FF3B30"},children:"Total outstanding balance"})})]}),e.jsxs("div",{style:{padding:"24px",flex:1,overflowY:"auto"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"12px",fontWeight:"700",color:"#8E8E93",letterSpacing:"0.8px",textTransform:"uppercase"},children:"BREAKDOWN"}),e.jsx("span",{style:{fontSize:"14px",fontWeight:"600",color:"var(--blue)",cursor:"pointer"},children:"View details"})]}),((y=t==null?void 0:t.transfers)==null?void 0:y.length)>0?t.transfers.map((s,j)=>{var b;return e.jsxs("div",{style:{background:"#F9F9FB",borderRadius:"20px",padding:"16px",marginBottom:"10px",display:"flex",alignItems:"center",gap:"14px"},children:[e.jsx(k,{name:s.from.name,size:"md",style:{width:"48px",height:"48px",fontSize:"17px",position:"relative"}}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("p",{style:{fontSize:"17px",fontWeight:"700",color:"#1C1C1E",margin:"0 0 3px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:((b=s.from.name)==null?void 0:b.split(" ")[0])||"Person"}),e.jsxs("p",{style:{fontSize:"13px",color:"#8E8E93",margin:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[s.to.name," â€¢ ",Math.ceil(Math.random()*3)," items"]})]}),e.jsxs("span",{style:{fontSize:"17px",fontWeight:"700",color:"#FF3B30",flexShrink:0},children:["-",g,s.amount.toFixed(2)]})]},j)}):e.jsx("div",{style:{textAlign:"center",padding:"40px 0",color:"#8E8E93",fontSize:"17px"},children:"ðŸŽ‰ All settled!"})]}),((S=t==null?void 0:t.transfers)==null?void 0:S.length)>0&&e.jsxs("div",{style:{padding:"16px 24px 40px"},children:[e.jsxs("button",{onClick:()=>x(!0),style:{width:"100%",padding:"18px 24px",background:"linear-gradient(135deg, #6347F5 0%, #4B32CC 100%)",color:"white",fontSize:"17px",fontWeight:"700",borderRadius:"100px",border:"none",cursor:"pointer",boxShadow:"0 8px 24px rgba(99,71,245,0.35)",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},children:[e.jsx("span",{style:{fontSize:"20px"},children:"ðŸ”"}),"Settle All",e.jsx("span",{style:{marginLeft:"4px"},children:"â†’"})]}),e.jsx("p",{style:{textAlign:"center",color:"#8E8E93",fontSize:"12px",marginTop:"10px",display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:"ðŸ”’ Payments secured by 256-bit encryption"})]}),e.jsxs(A,{show:v,title:"Settle All?",message:`Mark all ${(t==null?void 0:t.pendingCount)||0} payment(s) totalling ${g}${((t==null?void 0:t.totalToSettle)||0).toFixed(2)} as settled?`,onClose:()=>x(!1),variant:"alert",children:[e.jsx("div",{className:"modal-divider"}),e.jsxs("div",{className:"modal-actions-row",children:[e.jsx("button",{onClick:()=>x(!1),children:"Cancel"}),e.jsx("button",{className:"modal-btn-primary",onClick:w,disabled:m,children:m?"Settling...":"Confirm"})]})]})]})}export{D as default};
