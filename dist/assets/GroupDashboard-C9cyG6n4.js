import{b as N,u as Y,a as D,r as f,j as e}from"./index-DNKDXbwY.js";import{a as G,j as T}from"./index-BGOQgUEA.js";import{u as _}from"./groupStore-8BaMa8wT.js";import{u as J}from"./notificationStore-9uvxy9lv.js";import{A as P}from"./Avatar-DETDR1ce.js";import{M as X}from"./Modal-B2siUb_I.js";import{B as q}from"./BottomNav-HApZ-xSH.js";import{S as m}from"./Skeleton-Des0Eng2.js";import"./index-UWMBKVSd.js";const K=f.memo(function({member:l,isYou:b,currSymbol:c,isLast:S}){const h=l.user,a=l.net??0,n=l.subtext||"";let d,s;return a>.01?(d=`+ ${c}${Math.abs(a).toFixed(0)}`,s="#34C759"):a<-.01?(d=`- ${c}${Math.abs(a).toFixed(0)}`,s="#FF3B30"):(d=`${c}0`,s="#8E8E93"),e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsxs("div",{style:{marginRight:"14px",position:"relative",flexShrink:0,padding:"12px 0"},children:[e.jsx(P,{name:h.name}),b&&e.jsx("div",{style:{position:"absolute",bottom:"10px",right:"-4px",width:"16px",height:"16px",borderRadius:"50%",background:"#007AFF",border:"2px solid white",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("svg",{width:"8",height:"8",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M5 13l4 4L19 7",stroke:"white",strokeWidth:"3.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),e.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",padding:"12px 0",minWidth:0,borderBottom:S?"none":"0.5px solid rgba(0,0,0,0.08)"},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("p",{style:{fontSize:"17px",fontWeight:"600",lineHeight:"22px",color:"#000",margin:0},children:b?"You":h.name}),n&&e.jsx("p",{style:{fontSize:"13px",color:"#8E8E93",margin:"2px 0 0",lineHeight:"18px"},children:n})]}),e.jsx("span",{style:{fontSize:"17px",fontWeight:"700",color:s,flexShrink:0,marginLeft:"8px",letterSpacing:"-0.2px"},children:d})]})]})});function se(){var z,C,W,R,M,E,B,A,$;const{id:r}=N(),l=Y(),{activeGroup:b,loading:c,fetchGroup:S}=_(),{user:h}=D(),{sendReminder:a}=J(),[n,d]=f.useState(null),[s,w]=f.useState(""),[j,v]=f.useState(!1);f.useEffect(()=>{S(r)},[r]);const F=f.useCallback(async i=>{var p,u;if(n){v(!0);try{await a(n.id,r,Math.abs(n.amount),i),d(null),w("")}catch(x){alert(((u=(p=x.response)==null?void 0:p.data)==null?void 0:u.message)||"Failed to send reminder")}finally{v(!1)}}},[n,r,a]),t=b;if(!c&&!t)return e.jsx("div",{className:"page",style:{background:"#F2F2F7"},children:e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"Group not found"})})});const o=(t==null?void 0:t.currencySymbol)||"â‚¹",g=((z=t==null?void 0:t.pendingSettlements)==null?void 0:z[0])||null,k=((C=t==null?void 0:t.members)==null?void 0:C.map(i=>{var I,L,O;const p=i.user,u=(I=t.memberBalances)==null?void 0:I[p._id],x=(u==null?void 0:u.net)||0,H=p._id===(h==null?void 0:h._id);let y="";return H?y=`Paying for ${((L=t.members)==null?void 0:L.length)||1} share${(((O=t.members)==null?void 0:O.length)||1)>1?"s":""}`:Math.abs(x)<.01?y="Settled up":x>0?y=`Owes you ${o}${Math.abs(x).toFixed(0)}`:y=`You owe ${o}${Math.abs(x).toFixed(0)}`,{...i,net:x,subtext:y,isYou:H}}))||[];return e.jsxs("div",{className:"page",style:{background:"#F2F2F7",display:"flex",flexDirection:"column",minHeight:"100dvh"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 16px",minHeight:"44px",background:"#F2F2F7",position:"sticky",top:0,zIndex:100},children:[e.jsxs("button",{onClick:()=>l("/groups"),style:{display:"flex",alignItems:"center",gap:"2px",background:"none",border:"none",cursor:"pointer",padding:"4px 0",color:"#007AFF",fontSize:"17px",fontWeight:"400",minWidth:"60px"},children:[e.jsx(G,{style:{fontSize:"22px"}}),e.jsx("span",{children:"Back"})]}),e.jsx("h1",{style:{position:"absolute",left:"50%",transform:"translateX(-50%)",fontSize:"17px",fontWeight:"600",color:"#000",margin:0,maxWidth:"55%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:(t==null?void 0:t.name)||""}),e.jsx("button",{onClick:()=>l(`/groups/${r}/settings`),style:{background:"none",border:"none",cursor:"pointer",padding:"4px",color:"#007AFF",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(T,{style:{fontSize:"22px"}})})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",WebkitOverflowScrolling:"touch",padding:"0 16px",paddingBottom:"100px"},children:[c&&!t&&e.jsxs("div",{children:[e.jsxs("div",{style:{textAlign:"center",padding:"32px 0 24px"},children:[e.jsx(m,{width:"100px",height:"14px",style:{margin:"0 auto 12px"}}),e.jsx(m,{width:"200px",height:"40px",style:{margin:"0 auto 8px"}}),e.jsx(m,{width:"160px",height:"15px",style:{margin:"0 auto"}})]}),e.jsx(m,{height:"64px",borderRadius:"20px",style:{marginBottom:"32px"}}),e.jsx(m,{width:"140px",height:"20px",style:{marginBottom:"16px"}}),e.jsx(m,{height:"280px",borderRadius:"16px"})]}),t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{textAlign:"center",padding:"24px 0 16px"},children:[e.jsx("p",{style:{fontSize:"15px",color:"#8E8E93",fontWeight:"400",margin:"0 0 4px",lineHeight:"20px"},children:"Your balance"}),((W=t.balance)==null?void 0:W.youOwe)>0?e.jsxs("p",{style:{fontSize:"36px",fontWeight:"700",color:"#FF3B30",margin:"0 0 4px",lineHeight:"1.1",letterSpacing:"-0.5px"},children:["You owe ",o,t.balance.youOwe.toFixed(0)]}):((R=t.balance)==null?void 0:R.youAreOwed)>0?e.jsxs("p",{style:{fontSize:"36px",fontWeight:"700",color:"#34C759",margin:"0 0 4px",lineHeight:"1.1",letterSpacing:"-0.5px"},children:["You are owed ",o,t.balance.youAreOwed.toFixed(0)]}):e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",margin:"0 0 4px"},children:[e.jsxs("svg",{width:"28",height:"28",viewBox:"0 0 28 28",fill:"none",children:[e.jsx("circle",{cx:"14",cy:"14",r:"14",fill:"#34C759"}),e.jsx("path",{d:"M8 14.5l3.5 3.5L20 10",stroke:"white",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),e.jsx("span",{style:{fontSize:"20px",fontWeight:"700",color:"#34C759"},children:"All Settled"})]}),e.jsxs("p",{style:{fontSize:"15px",color:"#8E8E93",fontWeight:"400",margin:0,lineHeight:"20px"},children:["Total group spend ",o,(((M=t.balance)==null?void 0:M.totalSpend)||0).toLocaleString("en-IN")]})]}),(((E=t.balance)==null?void 0:E.youOwe)>0||g)&&e.jsxs("div",{style:{background:"rgba(0,122,255,0.08)",borderRadius:"20px",padding:"16px",display:"flex",alignItems:"center",gap:"12px",marginBottom:"32px",boxShadow:"0 1px 3px rgba(0,0,0,0.04)"},children:[e.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:"rgba(0,122,255,0.12)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx("span",{style:{fontSize:"18px",fontWeight:"700",color:"#007AFF"},children:o})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("p",{style:{fontSize:"15px",fontWeight:"600",color:"#000",margin:0,lineHeight:"20px"},children:[o,((g==null?void 0:g.amount)||((B=t.balance)==null?void 0:B.youOwe)||0).toFixed(0)," pending settlement"]}),e.jsx("p",{style:{fontSize:"13px",color:"#8E8E93",margin:"2px 0 0",lineHeight:"18px"},children:g?`From ${(($=(A=g.from)==null?void 0:A.name)==null?void 0:$.split(" ")[0])||"member"}`:"Tap to settle"})]}),e.jsx("button",{onClick:()=>l(`/groups/${r}/settle`),style:{background:"#007AFF",color:"white",fontSize:"14px",fontWeight:"600",padding:"0 16px",height:"36px",borderRadius:"20px",border:"none",cursor:"pointer",flexShrink:0,whiteSpace:"nowrap",transition:"transform 120ms ease-out"},children:"Settle Now"})]}),e.jsx("h2",{style:{fontSize:"22px",fontWeight:"700",color:"#000",margin:"0 0 16px",letterSpacing:"-0.3px"},children:"Member Balances"}),e.jsx("div",{style:{background:"#FFFFFF",borderRadius:"20px",padding:"0 16px",boxShadow:"0 1px 2px rgba(0,0,0,0.04), 0 2px 8px rgba(0,0,0,0.04)"},children:k.map((i,p)=>e.jsx(K,{member:i,isYou:i.isYou,currSymbol:o,isLast:p===k.length-1},i.user._id))}),e.jsx("div",{style:{height:"24px"}})]})]}),e.jsx(q,{}),n&&e.jsx(X,{show:!!n,onClose:()=>d(null),title:`Remind ${n.name}`,variant:"sheet",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px",padding:"8px 0"},children:[e.jsxs("p",{style:{fontSize:"15px",color:"#8E8E93"},children:["Send a friendly nudge about the ",o,Math.abs(n.amount).toFixed(0)," outstanding."]}),e.jsx("button",{onClick:()=>F("Hey! Just a reminder about the payment."),disabled:j,style:{padding:"12px 16px",textAlign:"left",background:"#F2F2F7",color:"#000",border:"none",borderRadius:"12px",fontSize:"15px",cursor:"pointer"},children:'"Hey! Just a reminder about the payment."'}),e.jsx("button",{onClick:()=>F("Don't forget to settle up!"),disabled:j,style:{padding:"12px 16px",textAlign:"left",background:"#F2F2F7",color:"#000",border:"none",borderRadius:"12px",fontSize:"15px",cursor:"pointer"},children:`"Don't forget to settle up!"`}),e.jsxs("div",{style:{marginTop:"4px"},children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"600",color:"#8E8E93",display:"block",marginBottom:"8px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Custom Message"}),e.jsx("textarea",{value:s,onChange:i=>w(i.target.value),placeholder:"Write your own message...",style:{width:"100%",padding:"12px",borderRadius:"12px",border:"1px solid rgba(0,0,0,0.08)",background:"#F2F2F7",minHeight:"80px",outline:"none",fontSize:"15px",fontFamily:"inherit",resize:"none",transition:"border-color 200ms ease, box-shadow 200ms ease"}})]}),e.jsx("button",{className:"btn-primary",onClick:()=>F(s),disabled:j||!s.trim(),style:{marginTop:"4px"},children:j?"Sending...":"Send Custom Reminder"})]})})]})}export{se as default};
