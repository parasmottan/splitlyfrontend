import{b as N,u as Y,a as D,r as f,j as e}from"./index-G39e3T5Q.js";import{a as G,j as T}from"./index-DM_Tb7vG.js";import{u as _}from"./groupStore-CnJdueKS.js";import{u as J}from"./notificationStore-CzUfbedj.js";import{A as P}from"./Avatar-B6SMP7eY.js";import{M as X}from"./Modal-CzmNkfup.js";import{B as q}from"./BottomNav-D8eaXMZT.js";import{S as m}from"./Skeleton-BENDw-25.js";import"./index-B8mukvke.js";const K=f.memo(function({member:l,isYou:b,currSymbol:c,isLast:S}){const h=l.user,a=l.net??0,n=l.subtext||"";let d,s;return a>.01?(d=`+ ${c}${Math.abs(a).toFixed(0)}`,s="#34C759"):a<-.01?(d=`- ${c}${Math.abs(a).toFixed(0)}`,s="#FF3B30"):(d=`${c}0`,s="#8E8E93"),e.jsxs("div",{style:{display:"flex",alignItems:"center",padding:"14px 16px",borderBottom:S?"none":"0.5px solid rgba(0,0,0,0.06)"},children:[e.jsxs("div",{style:{marginRight:"12px",position:"relative",flexShrink:0},children:[e.jsx(P,{name:h.name}),b&&e.jsx("div",{style:{position:"absolute",bottom:"-1px",right:"-3px",width:"18px",height:"18px",borderRadius:"50%",background:"#007AFF",border:"2.5px solid white",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("svg",{width:"9",height:"9",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M5 13l4 4L19 7",stroke:"white",strokeWidth:"3.5",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("p",{style:{fontSize:"17px",fontWeight:"600",lineHeight:"22px",color:"#000",margin:0},children:b?"You":h.name}),n&&e.jsx("p",{style:{fontSize:"13px",color:"#8E8E93",margin:"2px 0 0",lineHeight:"18px"},children:n})]}),e.jsx("span",{style:{fontSize:"17px",fontWeight:"700",color:s,flexShrink:0,marginLeft:"12px",letterSpacing:"-0.3px"},children:d})]})});function se(){var C,z,W,R,E,M,B,A,$;const{id:r}=N(),l=Y(),{activeGroup:b,loading:c,fetchGroup:S}=_(),{user:h}=D(),{sendReminder:a}=J(),[n,d]=f.useState(null),[s,w]=f.useState(""),[j,v]=f.useState(!1);f.useEffect(()=>{S(r)},[r]);const F=f.useCallback(async i=>{var p,u;if(n){v(!0);try{await a(n.id,r,Math.abs(n.amount),i),d(null),w("")}catch(x){alert(((u=(p=x.response)==null?void 0:p.data)==null?void 0:u.message)||"Failed to send reminder")}finally{v(!1)}}},[n,r,a]),t=b;if(!c&&!t)return e.jsx("div",{className:"page",style:{background:"#F2F2F7"},children:e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"Group not found"})})});const o=(t==null?void 0:t.currencySymbol)||"â‚¹",g=((C=t==null?void 0:t.pendingSettlements)==null?void 0:C[0])||null,k=((z=t==null?void 0:t.members)==null?void 0:z.map(i=>{var I,L,O;const p=i.user,u=(I=t.memberBalances)==null?void 0:I[p._id],x=(u==null?void 0:u.net)||0,H=p._id===(h==null?void 0:h._id);let y="";return H?y=`Paying for ${((L=t.members)==null?void 0:L.length)||1} share${(((O=t.members)==null?void 0:O.length)||1)>1?"s":""}`:Math.abs(x)<.01?y="Settled up":x>0?y=`Owes you ${o}${Math.abs(x).toFixed(0)}`:y=`You owe ${o}${Math.abs(x).toFixed(0)}`,{...i,net:x,subtext:y,isYou:H}}))||[];return e.jsxs("div",{style:{background:"#F2F2F7",display:"flex",flexDirection:"column",minHeight:"100dvh",maxWidth:"430px",margin:"0 auto",position:"relative"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 16px",minHeight:"44px",background:"#F2F2F7",position:"sticky",top:0,zIndex:10},children:[e.jsxs("button",{onClick:()=>l("/groups"),style:{display:"flex",alignItems:"center",gap:"2px",background:"none",border:"none",cursor:"pointer",padding:0,color:"#007AFF",fontSize:"17px",fontWeight:"400",minWidth:"60px"},children:[e.jsx(G,{style:{fontSize:"24px"}}),e.jsx("span",{children:"Back"})]}),e.jsx("h1",{style:{position:"absolute",left:"50%",transform:"translateX(-50%)",fontSize:"17px",fontWeight:"600",color:"#000",margin:0,maxWidth:"55%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:(t==null?void 0:t.name)||""}),e.jsx("button",{onClick:()=>l(`/groups/${r}/settings`),style:{background:"none",border:"none",cursor:"pointer",padding:0,color:"#007AFF",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(T,{style:{fontSize:"24px"}})})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",WebkitOverflowScrolling:"touch",padding:"0 20px",paddingBottom:"100px"},children:[c&&!t&&e.jsxs("div",{children:[e.jsxs("div",{style:{textAlign:"center",padding:"48px 0 24px"},children:[e.jsx(m,{width:"100px",height:"14px",style:{margin:"0 auto 12px"}}),e.jsx(m,{width:"220px",height:"44px",style:{margin:"0 auto 10px"}}),e.jsx(m,{width:"180px",height:"16px",style:{margin:"0 auto"}})]}),e.jsx(m,{height:"68px",borderRadius:"24px",style:{marginBottom:"36px"}}),e.jsx(m,{width:"160px",height:"22px",style:{marginBottom:"16px"}}),e.jsx(m,{height:"300px",borderRadius:"16px"})]}),t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{textAlign:"center",padding:"44px 0 8px"},children:[e.jsx("p",{style:{fontSize:"16px",color:"#34C759",fontWeight:"500",margin:"0 0 10px",lineHeight:"20px"},children:"Your balance"}),((W=t.balance)==null?void 0:W.youOwe)>0?e.jsxs("p",{style:{fontSize:"40px",fontWeight:"700",color:"#FF3B30",margin:"0 0 10px",lineHeight:"1.05",letterSpacing:"-0.8px"},children:["You owe ",o,t.balance.youOwe.toFixed(0)]}):((R=t.balance)==null?void 0:R.youAreOwed)>0?e.jsxs("p",{style:{fontSize:"40px",fontWeight:"700",color:"#34C759",margin:"0 0 10px",lineHeight:"1.05",letterSpacing:"-0.8px"},children:["You are owed ",o,t.balance.youAreOwed.toFixed(0)]}):e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",margin:"0 0 10px"},children:[e.jsxs("svg",{width:"28",height:"28",viewBox:"0 0 28 28",fill:"none",children:[e.jsx("circle",{cx:"14",cy:"14",r:"14",fill:"#34C759"}),e.jsx("path",{d:"M8 14.5l3.5 3.5L20 10",stroke:"white",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})]}),e.jsx("span",{style:{fontSize:"22px",fontWeight:"700",color:"#34C759"},children:"All Settled"})]}),e.jsxs("p",{style:{fontSize:"15px",color:"#8E8E93",fontWeight:"400",margin:0,lineHeight:"20px"},children:["Total group spend ",e.jsxs("span",{style:{color:"#1C1C1E",fontWeight:"600"},children:[o,(((E=t.balance)==null?void 0:E.totalSpend)||0).toLocaleString("en-IN")]})]})]}),(((M=t.balance)==null?void 0:M.youOwe)>0||g)&&e.jsxs("div",{style:{background:"#EBF2FF",borderRadius:"24px",padding:"14px 16px",display:"flex",alignItems:"center",gap:"12px",margin:"28px 0 0"},children:[e.jsx("div",{style:{width:"44px",height:"44px",borderRadius:"50%",background:"rgba(0,122,255,0.10)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx("span",{style:{fontSize:"20px",fontWeight:"700",color:"#007AFF"},children:o})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("p",{style:{fontSize:"15px",fontWeight:"600",color:"#1C1C1E",margin:0,lineHeight:"20px"},children:[o,((g==null?void 0:g.amount)||((B=t.balance)==null?void 0:B.youOwe)||0).toFixed(0)," pending settlement"]}),e.jsx("p",{style:{fontSize:"13px",color:"#8E8E93",margin:"1px 0 0",lineHeight:"18px"},children:g?`From ${(($=(A=g.from)==null?void 0:A.name)==null?void 0:$.split(" ")[0])||"member"}`:"Tap to settle"})]}),e.jsx("button",{onClick:()=>l(`/groups/${r}/settle`),style:{background:"#007AFF",color:"white",fontSize:"15px",fontWeight:"600",padding:"0 20px",height:"36px",borderRadius:"18px",border:"none",cursor:"pointer",flexShrink:0,whiteSpace:"nowrap",transition:"transform 120ms ease-out",display:"flex",alignItems:"center"},children:"Settle Now"})]}),e.jsx("h2",{style:{fontSize:"22px",fontWeight:"700",color:"#1C1C1E",margin:"36px 0 14px",letterSpacing:"-0.3px",lineHeight:"28px"},children:"Member Balances"}),e.jsx("div",{style:{background:"#FFFFFF",borderRadius:"16px",overflow:"hidden",boxShadow:"0 0.5px 1px rgba(0,0,0,0.04), 0 2px 6px rgba(0,0,0,0.03)"},children:k.map((i,p)=>e.jsx(K,{member:i,isYou:i.isYou,currSymbol:o,isLast:p===k.length-1},i.user._id))}),e.jsx("div",{style:{height:"24px"}})]})]}),e.jsx(q,{}),n&&e.jsx(X,{show:!!n,onClose:()=>d(null),title:`Remind ${n.name}`,variant:"sheet",children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px",padding:"8px 0"},children:[e.jsxs("p",{style:{fontSize:"15px",color:"#8E8E93"},children:["Send a friendly nudge about the ",o,Math.abs(n.amount).toFixed(0)," outstanding."]}),e.jsx("button",{onClick:()=>F("Hey! Just a reminder about the payment."),disabled:j,style:{padding:"12px 16px",textAlign:"left",background:"#F2F2F7",color:"#000",border:"none",borderRadius:"12px",fontSize:"15px",cursor:"pointer"},children:'"Hey! Just a reminder about the payment."'}),e.jsx("button",{onClick:()=>F("Don't forget to settle up!"),disabled:j,style:{padding:"12px 16px",textAlign:"left",background:"#F2F2F7",color:"#000",border:"none",borderRadius:"12px",fontSize:"15px",cursor:"pointer"},children:`"Don't forget to settle up!"`}),e.jsxs("div",{style:{marginTop:"4px"},children:[e.jsx("label",{style:{fontSize:"13px",fontWeight:"600",color:"#8E8E93",display:"block",marginBottom:"8px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Custom Message"}),e.jsx("textarea",{value:s,onChange:i=>w(i.target.value),placeholder:"Write your own message...",style:{width:"100%",padding:"12px",borderRadius:"12px",border:"1px solid rgba(0,0,0,0.08)",background:"#F2F2F7",minHeight:"80px",outline:"none",fontSize:"15px",fontFamily:"inherit",resize:"none",transition:"border-color 200ms ease, box-shadow 200ms ease"}})]}),e.jsx("button",{className:"btn-primary",onClick:()=>F(s),disabled:j||!s.trim(),style:{marginTop:"4px"},children:j?"Sending...":"Send Custom Reminder"})]})})]})}export{se as default};
