import{c as L,d as P,b as J,u as K,a as Q,r as i,j as e}from"./index-CJ3aYF7-.js";import{a as W,I as D}from"./index-DgwPC8f5.js";import{u as V}from"./groupStore-DKf8PMM7.js";import{S as x}from"./Skeleton-C3WxFkFk.js";const X=L(a=>({expenses:[],loading:!1,error:null,fetchExpenses:async p=>{var s,l;try{a({loading:!0,error:null});const{data:n}=await P.get(`/expenses/${p}`);a({expenses:n,loading:!1})}catch(n){a({error:((l=(s=n.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to fetch expenses",loading:!1})}},addExpense:async p=>{var s,l;try{a({loading:!0,error:null});const{data:n}=await P.post("/expenses",p);return a(c=>({expenses:[n,...c.expenses],loading:!1})),n}catch(n){const c=((l=(s=n.response)==null?void 0:s.data)==null?void 0:l.message)||"Failed to add expense";throw a({error:c,loading:!1}),new Error(c)}},clearExpenses:()=>a({expenses:[],error:null})})),O=[{key:"food",label:"Food & Dining",initial:"F"},{key:"transport",label:"Transport",initial:"T"},{key:"groceries",label:"Groceries",initial:"G"},{key:"entertainment",label:"Entertainment",initial:"E"},{key:"utilities",label:"Utilities",initial:"U"},{key:"rent",label:"Rent",initial:"R"},{key:"travel",label:"Travel",initial:"T"},{key:"shopping",label:"Shopping",initial:"S"},{key:"other",label:"Others",initial:"O"}];function se(){var A,B,F,T,R;const{id:a}=J(),p=K(),{activeGroup:s,fetchGroup:l}=V(),{addExpense:n,loading:c}=X(),{user:r}=Q(),[v,q]=i.useState(""),[d,G]=i.useState(""),[f,Y]=i.useState("food"),[j,w]=i.useState(""),[o,$]=i.useState("equal"),[N,E]=i.useState(!1),[C,z]=i.useState(!1),[S,H]=i.useState({}),[_,h]=i.useState("");i.useEffect(()=>{(!s||s._id!==a)&&l(a)},[a]),i.useEffect(()=>{r&&w(r._id)},[r]);const u=O.find(t=>t.key===f),g=(B=(A=s==null?void 0:s.members)==null?void 0:A.find(t=>t.user._id===j))==null?void 0:B.user,U=async()=>{if(!v.trim()){h("Description is required");return}if(!d||parseFloat(d)<=0){h("Enter a valid amount");return}const t={groupId:a,description:v.trim(),amount:parseFloat(d),category:f,paidBy:j,splitType:o};if(o==="custom"){const m=Object.entries(S).map(([y,k])=>({user:y,amount:parseFloat(k)||0})).filter(y=>y.amount>0),I=m.reduce((y,k)=>y+k.amount,0);if(Math.abs(I-parseFloat(d))>.01){h(`Split total (₹${I.toFixed(2)}) doesn't match amount (₹${parseFloat(d).toFixed(2)})`);return}t.splits=m}try{await n(t),await l(a),p(`/groups/${a}`,{replace:!0})}catch(m){h(m.message)}};if(!s)return e.jsxs("div",{className:"page page-white",children:[e.jsxs("div",{className:"header",style:{padding:"12px 20px"},children:[e.jsxs("button",{className:"header-back",onClick:()=>p(-1),children:[e.jsx(W,{style:{fontSize:"20px"}})," Back"]}),e.jsx("span",{className:"header-title",children:"Add Expense"}),e.jsx("div",{style:{width:"60px"}})]}),e.jsxs("div",{style:{padding:"0 20px"},children:[e.jsxs("div",{style:{textAlign:"center",padding:"24px 0"},children:[e.jsx(x,{width:"60px",height:"14px",style:{margin:"0 auto 8px"}}),e.jsx(x,{width:"120px",height:"40px",style:{margin:"0 auto"}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx(x,{width:"100px",height:"13px",style:{marginBottom:"8px"}}),e.jsx(x,{height:"48px",borderRadius:"12px"})]}),e.jsxs("div",{className:"card",style:{marginBottom:"24px"},children:[e.jsx("div",{className:"form-row",children:e.jsx(x,{width:"100%",height:"20px"})}),e.jsx("div",{className:"form-row",children:e.jsx(x,{width:"100%",height:"20px"})})]}),e.jsx(x,{height:"56px",borderRadius:"14px"})]})]});const b=s.currencySymbol||"₹";return e.jsxs("div",{className:"page page-white",style:{display:"flex",flexDirection:"column",minHeight:"100dvh"},children:[e.jsxs("div",{className:"header",style:{padding:"12px 20px"},children:[e.jsxs("button",{className:"header-back",onClick:()=>p(-1),children:[e.jsx(W,{style:{fontSize:"20px"}})," Back"]}),e.jsx("span",{className:"header-title",children:"Add Expense"}),e.jsx("div",{style:{width:"60px"}})]}),e.jsx("div",{style:{padding:"0 20px",flex:1,overflowY:"auto"},children:e.jsxs("div",{style:{marginTop:"8px"},children:[_&&e.jsx("div",{style:{background:"var(--red-light)",color:"var(--red)",padding:"12px 16px",borderRadius:"12px",marginBottom:"16px",fontSize:"15px",lineHeight:"1.4"},children:_}),e.jsxs("div",{style:{textAlign:"center",padding:"24px 0"},children:[e.jsx("p",{style:{fontSize:"13px",color:"var(--text-secondary)",marginBottom:"8px",textTransform:"uppercase",letterSpacing:"0.5px",fontWeight:"500"},children:"Amount"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("span",{style:{fontSize:"36px",fontWeight:"700",color:"var(--text-primary)",marginRight:"4px"},children:b}),e.jsx("input",{type:"number",placeholder:"0.00",value:d,onChange:t=>{G(t.target.value),h("")},style:{fontSize:"36px",fontWeight:"700",border:"none",width:"160px",textAlign:"center",background:"transparent",outline:"none"}})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx("input",{className:"form-input",type:"text",placeholder:"e.g. Dinner at restaurant",value:v,onChange:t=>{q(t.target.value),h("")}})]}),e.jsxs("div",{className:"card",style:{padding:"0 16px",marginBottom:"16px"},children:[e.jsxs("div",{className:"form-row",onClick:()=>E(!N),style:{cursor:"pointer"},children:[e.jsx("span",{className:"form-row-label",children:"Category"}),e.jsxs("span",{className:"form-row-value",children:[e.jsx("span",{style:{width:"24px",height:"24px",borderRadius:"6px",background:"var(--gray-100)",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"13px",fontWeight:"600",color:"var(--text-secondary)",marginRight:"6px"},children:u==null?void 0:u.initial}),u==null?void 0:u.label,e.jsx(D,{style:{fontSize:"16px",color:"var(--gray-400)"}})]})]}),N&&e.jsx("div",{style:{padding:"4px 0",borderTop:"0.5px solid var(--gray-200)"},children:O.map(t=>e.jsxs("div",{style:{padding:"10px 0",cursor:"pointer",display:"flex",alignItems:"center",gap:"12px",color:f===t.key?"var(--blue)":"var(--text-primary)",fontWeight:f===t.key?"600":"400",fontSize:"17px"},onClick:()=>{Y(t.key),E(!1)},children:[e.jsx("span",{style:{width:"28px",height:"28px",borderRadius:"6px",background:"var(--gray-100)",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"14px",fontWeight:"600",color:"var(--text-secondary)"},children:t.initial}),t.label]},t.key))}),e.jsxs("div",{className:"form-row",onClick:()=>z(!C),style:{cursor:"pointer"},children:[e.jsx("span",{className:"form-row-label",children:"Paid by"}),e.jsxs("span",{className:"form-row-value",children:[(g==null?void 0:g._id)===(r==null?void 0:r._id)?"You":(g==null?void 0:g.name)||"Select",e.jsx(D,{style:{fontSize:"16px",color:"var(--gray-400)"}})]})]}),C&&e.jsx("div",{style:{padding:"4px 0",borderTop:"0.5px solid var(--gray-200)"},children:(F=s.members)==null?void 0:F.map(t=>e.jsx("div",{style:{padding:"10px 0",cursor:"pointer",color:j===t.user._id?"var(--blue)":"var(--text-primary)",fontWeight:j===t.user._id?"600":"400",fontSize:"17px"},onClick:()=>{w(t.user._id),z(!1)},children:t.user._id===(r==null?void 0:r._id)?"You":t.user.name},t.user._id))})]}),e.jsx("h3",{className:"caption",style:{marginBottom:"12px"},children:"SPLIT METHOD"}),e.jsx("div",{style:{display:"flex",marginBottom:"16px",background:"var(--gray-200)",borderRadius:"10px",padding:"2px"},children:["equal","custom"].map(t=>e.jsx("button",{onClick:()=>$(t),style:{flex:1,padding:"10px",background:o===t?"var(--white)":"transparent",borderRadius:o===t?"8px":"0",color:o===t?"var(--text-primary)":"var(--text-secondary)",fontWeight:o===t?"600":"400",fontSize:"15px",border:"none",cursor:"pointer",boxShadow:o===t?"var(--shadow-sm)":"none",textTransform:"capitalize",transition:"all 200ms ease-out"},children:t},t))}),o==="custom"&&e.jsx("div",{className:"card",style:{padding:"8px 16px",marginBottom:"16px"},children:(T=s.members)==null?void 0:T.map(t=>e.jsxs("div",{className:"form-row",children:[e.jsx("span",{style:{fontSize:"17px"},children:t.user._id===(r==null?void 0:r._id)?"You":t.user.name}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{style:{color:"var(--text-secondary)"},children:b}),e.jsx("input",{type:"number",placeholder:"0.00",value:S[t.user._id]||"",onChange:m=>H({...S,[t.user._id]:m.target.value}),style:{width:"80px",textAlign:"right",border:"none",fontSize:"17px",fontWeight:"600",background:"transparent",outline:"none"}})]})]},t.user._id))}),o==="equal"&&d&&e.jsxs("p",{style:{fontSize:"15px",color:"var(--text-secondary)",textAlign:"center",marginBottom:"16px"},children:[b,(parseFloat(d)/(((R=s.members)==null?void 0:R.length)||1)).toFixed(2)," per person"]}),e.jsx("button",{className:"btn-primary",onClick:U,disabled:c,style:{marginBottom:"32px"},children:c?"Adding...":"Add Expense"})]})})]})}export{se as default};
